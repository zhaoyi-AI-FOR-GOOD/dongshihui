"use strict";(self.webpackChunkdongshihui_frontend=self.webpackChunkdongshihui_frontend||[]).push([[353],{355:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y});var s=n(8),i=n(9950),r=n(9808),o=n(2053),a=n(2235),l=n(6491),c=n(8216),d=n(899),x=n(8089),h=n(704),u=n(5277),m=n(5333),A=n(9925),g=n(2046),j=n(5979),p=n(9647),f=n(6101),y=n(3266),b=n(4753),v=n(4745),_=n(3464),C=n(33),w=n(8170),k=n(9739),S=n(5365),z=n(4195),I=n(3563),F=n(6589),W=n(4857),E=n(1451),H=n(9223),B=n(8924),T=n(1718),R=n(2570),D=n(2375),M=n(9532),L=n(7988),q=n(4453),O=n(8429),P=n(1920),U=n(1521),Q=n(922),N=n(5887),J=n(4414);const Y=()=>{var e,t;const n=(0,O.Zp)(),Y=(0,P.useQueryClient)(),G=(0,W.A)(),Z=(0,F.A)(G.breakpoints.down("md")),[V,K]=(0,i.useState)({status:"all",search:"",page:1}),[X,$]=(0,i.useState)({open:!1,meeting:null}),[ee,te]=(0,i.useState)({anchorEl:null,meeting:null}),{data:ne,isLoading:se}=(0,P.useQuery)(["meetings",V],async()=>{const e=new URLSearchParams((0,s.A)((0,s.A)({limit:"12",offset:(12*(V.page-1)).toString()},"all"!==V.status&&{status:V.status}),V.search&&{search:V.search})),t=await fetch("https://dongshihui-api.jieshu2023.workers.dev/meetings?".concat(e)),n=await t.json();if(!n.success)throw new Error(n.error||"\u83b7\u53d6\u4f1a\u8bae\u5217\u8868\u5931\u8d25");return n},{staleTime:12e4,cacheTime:6e5,keepPreviousData:!0,onError:e=>{N.Ay.error("\u83b7\u53d6\u4f1a\u8bae\u5217\u8868\u5931\u8d25: "+e.message)}}),ie=(null===ne||void 0===ne?void 0:ne.data)||[],re=(null===ne||void 0===ne?void 0:ne.pagination)||{},oe=(0,P.useMutation)(async e=>{const t=await fetch("https://dongshihui-api.jieshu2023.workers.dev/meetings/".concat(e),{method:"DELETE"}),n=await t.json();if(!n.success)throw new Error(n.error||"\u5220\u9664\u5931\u8d25");return n},{onSuccess:()=>{N.Ay.success("\u4f1a\u8bae\u5220\u9664\u6210\u529f"),Y.invalidateQueries("meetings"),$({open:!1,meeting:null})},onError:e=>{N.Ay.error("\u5220\u9664\u5931\u8d25: "+e.message)}}),ae=(0,i.useMemo)(()=>[{value:"all",label:"\u5168\u90e8\u4f1a\u8bae"},{value:"preparing",label:"\u51c6\u5907\u4e2d"},{value:"discussing",label:"\u8ba8\u8bba\u4e2d"},{value:"paused",label:"\u5df2\u6682\u505c"},{value:"finished",label:"\u5df2\u7ed3\u675f"}],[]),le=(0,i.useMemo)(()=>({preparing:{label:"\u51c6\u5907\u4e2d",color:"default"},discussing:{label:"\u8ba8\u8bba\u4e2d",color:"success"},debating:{label:"\u8fa9\u8bba\u4e2d",color:"warning"},paused:{label:"\u5df2\u6682\u505c",color:"info"},finished:{label:"\u5df2\u7ed3\u675f",color:"error"}}),[]),ce=(0,i.useCallback)(e=>le[e]||{label:e,color:"default"},[le]),de=(0,i.useCallback)((e,t)=>{K(n=>(0,s.A)((0,s.A)({},n),{},{[e]:t,page:1}))},[]),xe=(0,i.useCallback)(e=>{K(t=>(0,s.A)((0,s.A)({},t),{},{search:e,page:1}))},[]),he=(0,i.useCallback)((e,t)=>{te({anchorEl:e.currentTarget,meeting:t})},[]),ue=(0,i.useCallback)(()=>{te({anchorEl:null,meeting:null})},[]),me=()=>(0,J.jsx)(d.Ay,{container:!0,spacing:Z?2:3,children:[...Array(6)].map((e,t)=>(0,J.jsx)(d.Ay,{item:!0,xs:12,sm:6,lg:4,children:(0,J.jsx)(x.A,{sx:{height:"100%"},children:(0,J.jsxs)(h.A,{sx:{p:Z?2.5:3},children:[(0,J.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,J.jsx)(l.A,{sx:{width:"60%",height:24,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}}),(0,J.jsx)(l.A,{sx:{width:60,height:24,bgcolor:"grey.200",borderRadius:12,animation:"pulse 1.5s ease-in-out infinite"}})]}),(0,J.jsx)(l.A,{sx:{width:"80%",height:16,bgcolor:"grey.200",borderRadius:1,mb:1,animation:"pulse 1.5s ease-in-out infinite"}}),(0,J.jsx)(l.A,{sx:{width:"60%",height:16,bgcolor:"grey.200",borderRadius:1,mb:2,animation:"pulse 1.5s ease-in-out infinite"}}),(0,J.jsx)(v.A,{sx:{my:2}}),(0,J.jsx)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[...Array(3)].map((e,t)=>(0,J.jsx)(l.A,{sx:{width:60,height:16,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}},t))}),(0,J.jsxs)(l.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[(0,J.jsx)(l.A,{sx:{width:80,height:36,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}}),(0,J.jsx)(l.A,{sx:{width:36,height:36,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}})]})]})})},t))});return se&&!ne?(0,J.jsxs)(r.A,{maxWidth:"lg",sx:{py:Z?2:4},children:[(0,J.jsxs)(l.A,{sx:{mb:Z?3:4},children:[(0,J.jsx)(l.A,{sx:{width:200,height:32,bgcolor:"grey.200",borderRadius:1,mb:1,animation:"pulse 1.5s ease-in-out infinite"}}),(0,J.jsx)(l.A,{sx:{width:300,height:20,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}})]}),(0,J.jsx)(a.A,{sx:{p:Z?2:3,mb:Z?2:3},children:(0,J.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,J.jsx)(d.Ay,{item:!0,xs:12,md:4,children:(0,J.jsx)(l.A,{sx:{height:56,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}})}),(0,J.jsx)(d.Ay,{item:!0,xs:12,md:3,children:(0,J.jsx)(l.A,{sx:{height:56,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}})})]})}),(0,J.jsx)(me,{})]}):(0,J.jsxs)(r.A,{maxWidth:"lg",sx:{py:Z?2:4},children:[(0,J.jsxs)(l.A,{sx:{display:"flex",flexDirection:Z?"column":"row",justifyContent:"space-between",alignItems:Z?"stretch":"center",gap:Z?2:0,mb:Z?3:4},children:[(0,J.jsxs)(l.A,{children:[(0,J.jsx)(o.A,{variant:Z?"h5":"h4",gutterBottom:!0,sx:{fontWeight:600},children:"\u4f1a\u8bae\u5386\u53f2"}),(0,J.jsx)(o.A,{variant:"body1",color:"text.secondary",children:"\u56de\u987e\u548c\u7ba1\u7406\u5386\u53f2\u8463\u4e8b\u4f1a\u4f1a\u8bae\u8bb0\u5f55"})]}),(0,J.jsx)(c.A,{variant:"contained",startIcon:(0,J.jsx)(M.A,{}),onClick:()=>n("/meetings/create"),sx:{borderRadius:2,minHeight:Z?48:"auto",fontSize:Z?"1rem":"0.875rem"},size:Z?"large":"medium",fullWidth:Z,children:"\u521b\u5efa\u65b0\u4f1a\u8bae"})]}),(0,J.jsx)(a.A,{sx:{p:Z?2:3,mb:Z?2:3},children:(0,J.jsxs)(d.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,J.jsx)(d.Ay,{item:!0,xs:12,md:4,children:(0,J.jsx)(A.A,{fullWidth:!0,placeholder:"\u641c\u7d22\u4f1a\u8bae\u6807\u9898\u6216\u8bdd\u9898...",value:V.search,onChange:e=>xe(e.target.value),size:"medium",InputProps:{startAdornment:(0,J.jsx)(g.A,{position:"start",children:(0,J.jsx)(H.A,{})})}})}),(0,J.jsx)(d.Ay,{item:!0,xs:12,md:3,children:(0,J.jsxs)(j.A,{fullWidth:!0,children:[(0,J.jsx)(p.A,{children:"\u4f1a\u8bae\u72b6\u6001"}),(0,J.jsx)(f.A,{value:V.status,label:"\u4f1a\u8bae\u72b6\u6001",onChange:e=>de("status",e.target.value),size:"medium",children:ae.map(e=>(0,J.jsx)(y.A,{value:e.value,children:e.label},e.value))})]})}),(0,J.jsx)(d.Ay,{item:!0,xs:12,md:5,children:(0,J.jsx)(l.A,{sx:{display:"flex",alignItems:"center",gap:2,justifyContent:Z?"center":"flex-start"},children:(0,J.jsxs)(o.A,{variant:"body2",color:"text.secondary",children:["\u5171 ",re.total||0," \u573a\u4f1a\u8bae"]})})})]})}),0===ie.length?(0,J.jsxs)(a.A,{sx:{p:6,textAlign:"center"},children:[(0,J.jsx)(E.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,J.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:V.search||"all"!==V.status?"\u6ca1\u6709\u627e\u5230\u5339\u914d\u7684\u4f1a\u8bae":"\u8fd8\u6ca1\u6709\u4f1a\u8bae\u8bb0\u5f55"}),(0,J.jsx)(o.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:V.search||"all"!==V.status?"\u5c1d\u8bd5\u8c03\u6574\u7b5b\u9009\u6761\u4ef6":"\u521b\u5efa\u7b2c\u4e00\u573a\u8463\u4e8b\u4f1a\u4f1a\u8bae\u5f00\u59cb\u8ba8\u8bba"}),(0,J.jsx)(c.A,{variant:"contained",onClick:()=>n("/meetings/create"),children:"\u521b\u5efa\u65b0\u4f1a\u8bae"})]}):(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(d.Ay,{container:!0,spacing:Z?2:3,children:ie.map(e=>{const t=ce(e.status);return(0,J.jsx)(d.Ay,{item:!0,xs:12,sm:6,lg:4,children:(0,J.jsx)(x.A,{sx:{height:"100%",transition:"all 0.2s ease","&:hover":{boxShadow:"0 6px 20px rgba(0,0,0,0.1)",transform:"translateY(-2px)"}},children:(0,J.jsxs)(h.A,{sx:{p:Z?2.5:3},children:[(0,J.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[(0,J.jsx)(o.A,{variant:"h6",sx:{fontWeight:600,color:"#333",fontSize:Z?"1rem":"1.1rem",lineHeight:1.3,flex:1,mr:1},children:e.title}),(0,J.jsx)(u.A,{label:t.label,color:t.color,size:"small",sx:{flexShrink:0}})]}),(0,J.jsx)(o.A,{variant:"body2",color:"text.secondary",sx:{mb:2,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",lineHeight:1.5},children:e.topic}),(0,J.jsx)(v.A,{sx:{my:2}}),(0,J.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,J.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,J.jsx)(T.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,J.jsxs)(o.A,{variant:"caption",color:"text.secondary",children:[e.total_statements||0," \u53d1\u8a00"]})]}),(0,J.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,J.jsx)(R.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,J.jsxs)(o.A,{variant:"caption",color:"text.secondary",children:[e.total_participants||0," \u8463\u4e8b"]})]}),(0,J.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,J.jsx)(B.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,J.jsx)(o.A,{variant:"caption",color:"text.secondary",children:e.created_at&&(0,U.A)(new Date(e.created_at),"MM-dd HH:mm",{locale:Q.A})})]})]}),(0,J.jsxs)(l.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end",flexDirection:Z?"column":"row"},children:[(0,J.jsx)(c.A,{size:Z?"medium":"small",startIcon:(0,J.jsx)(D.A,{}),onClick:()=>n("/meeting/".concat(e.id)),variant:"outlined",fullWidth:Z,sx:{minHeight:Z?44:"auto"},children:"finished"===e.status?"\u67e5\u770b\u8bb0\u5f55":"\u8fdb\u5165\u4f1a\u8bae"}),(0,J.jsx)(m.A,{size:Z?"medium":"small",onClick:t=>he(t,e),title:"\u66f4\u591a\u64cd\u4f5c",sx:{minHeight:Z?44:"auto",alignSelf:Z?"flex-end":"center"},children:(0,J.jsx)(q.A,{})})]})]})})},e.id)})}),re.total>12&&(0,J.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,J.jsx)(b.A,{count:Math.ceil(re.total/12),page:V.page,onChange:(e,t)=>de("page",t),color:"primary",size:"large"})})]}),(0,J.jsxs)(S.A,{anchorEl:ee.anchorEl,open:Boolean(ee.anchorEl),onClose:ue,children:[(0,J.jsxs)(y.A,{onClick:()=>{n("/meeting/".concat(ee.meeting.id)),ue()},children:[(0,J.jsx)(z.A,{children:(0,J.jsx)(D.A,{fontSize:"small"})}),(0,J.jsx)(I.A,{children:"finished"===(null===(e=ee.meeting)||void 0===e?void 0:e.status)?"\u67e5\u770b\u8bb0\u5f55":"\u8fdb\u5165\u4f1a\u8bae"})]}),(0,J.jsxs)(y.A,{onClick:()=>{$({open:!0,meeting:ee.meeting}),ue()},sx:{color:"error.main"},children:[(0,J.jsx)(z.A,{children:(0,J.jsx)(L.A,{fontSize:"small",color:"error"})}),(0,J.jsx)(I.A,{children:"\u5220\u9664\u4f1a\u8bae"})]})]}),(0,J.jsxs)(_.A,{open:X.open,onClose:()=>$({open:!1,meeting:null}),children:[(0,J.jsx)(C.A,{children:"\u786e\u8ba4\u5220\u9664\u4f1a\u8bae"}),(0,J.jsxs)(w.A,{children:[(0,J.jsxs)(o.A,{children:["\u786e\u5b9a\u8981\u5220\u9664\u4f1a\u8bae ",(0,J.jsxs)("strong",{children:['"',null===(t=X.meeting)||void 0===t?void 0:t.title,'"']})," \u5417\uff1f"]}),(0,J.jsx)(o.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u8be5\u4f1a\u8bae\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u5305\u62ec\u53d1\u8a00\u5185\u5bb9\u3001\u7528\u6237\u63d0\u95ee\u7b49\uff0c\u4e14\u65e0\u6cd5\u6062\u590d\u3002"})]}),(0,J.jsxs)(k.A,{children:[(0,J.jsx)(c.A,{onClick:()=>$({open:!1,meeting:null}),children:"\u53d6\u6d88"}),(0,J.jsx)(c.A,{color:"error",variant:"contained",onClick:()=>oe.mutate(X.meeting.id),disabled:oe.isLoading,children:oe.isLoading?"\u5220\u9664\u4e2d...":"\u786e\u8ba4\u5220\u9664"})]})]})]})}},7344:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ne});var s=n(9950),i=n(4857),r=n(6589),o=n(9808),a=n(2235),l=n(2053),c=n(6699),d=n(8216),x=n(6491),h=n(5277),u=n(5333),m=n(1413),A=n(899),g=n(4745),j=n(3174),p=n(3464),f=n(33),y=n(8170),b=n(9739),v=n(7596),_=n(2472),C=n(4801),w=n(6724),k=n(6549),S=n(5873),z=n(3794),I=n(3935),F=n(3212),W=n(1679),E=n(294),H=n(2059),B=n(2309),T=n(5986),R=n(6835),D=n(8429),M=n(1920),L=n(1521),q=n(922),O=n(5887),P=n(9181),U=n(3738),Q=n(9925),N=n(6413),J=n(5979),Y=n(9647),G=n(6101),Z=n(3266),V=n(6639),K=n(7169),X=n(5834),$=n(6592),ee=n(1673),te=n(4414);const ne=e=>{let{meetingId:t,onQuestionSubmitted:n,participants:o=[]}=e;const c=(0,i.A)(),A=(0,r.A)(c.breakpoints.down("md")),[g,j]=(0,s.useState)(""),[p,f]=(0,s.useState)(""),[y,b]=(0,s.useState)(!1),[v,_]=(0,s.useState)(!1),[C,w]=(0,s.useState)("all"),[k,S]=(0,s.useState)("");return(0,te.jsxs)(a.A,{elevation:2,sx:{p:2,mb:2,border:"2px dashed #e0e0e0"},children:[(0,te.jsxs)(x.A,{display:"flex",alignItems:"center",mb:1,children:[(0,te.jsx)(K.A,{color:"primary",sx:{mr:1,fontSize:A?20:24}}),(0,te.jsx)(l.A,{variant:A?"subtitle1":"h6",component:"h3",sx:{fontSize:A?"1rem":"1.25rem"},children:"\u5411\u8463\u4e8b\u4eec\u63d0\u95ee"}),(0,te.jsx)(u.A,{onClick:()=>_(!v),sx:{ml:"auto",minHeight:A?44:"auto"},size:A?"medium":"small",children:(0,te.jsx)(X.A,{sx:{transform:v?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"}})})]}),(0,te.jsx)(U.A,{in:v,children:(0,te.jsxs)(x.A,{component:"form",onSubmit:async e=>{if(e.preventDefault(),g.trim())if("specific"!==C||k){b(!0);try{const e=await fetch("https://dongshihui-api.jieshu2023.workers.dev/meetings/".concat(t,"/questions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:g.trim(),asker_name:p.trim()||"\u7528\u6237",question_type:"general",question_scope:C,target_director_id:"specific"===C?k:null})}),s=await e.json();if(s.success){j(""),_(!1),w("all"),S(""),n&&n(s.data);(async()=>{try{const e=await fetch("https://dongshihui-api.jieshu2023.workers.dev/meetings/".concat(t,"/questions/").concat(s.data.id,"/respond"),{method:"POST",headers:{"Content-Type":"application/json"}}),n=await e.json();n.success?console.log("\u8463\u4e8b\u56de\u590d\u751f\u6210\u6210\u529f\uff0c\u5171\u751f\u6210",n.data.responses.length,"\u4f4d\u8463\u4e8b\u7684\u56de\u590d"):console.error("\u8463\u4e8b\u56de\u590d\u751f\u6210\u5931\u8d25:",n.error)}catch(e){console.error("\u81ea\u52a8\u751f\u6210\u8463\u4e8b\u56de\u590d\u5931\u8d25:",e)}})()}}catch(s){console.error("\u63d0\u95ee\u5931\u8d25:",s)}finally{b(!1)}}else alert("\u8bf7\u9009\u62e9\u8981\u63d0\u95ee\u7684\u8463\u4e8b")},children:[(0,te.jsx)(Q.A,{fullWidth:!0,multiline:!0,rows:A?3:2,placeholder:"\u8f93\u5165\u4f60\u60f3\u95ee\u8463\u4e8b\u4eec\u7684\u95ee\u9898...",value:g,onChange:e=>j(e.target.value),sx:{mb:2},disabled:y,size:"medium"}),(0,te.jsxs)(x.A,{sx:{mb:2},children:[(0,te.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"\u63d0\u95ee\u65b9\u5f0f\uff1a"}),(0,te.jsxs)(N.A,{variant:"outlined",size:A?"medium":"small",fullWidth:A,value:C,disabled:y,children:[(0,te.jsx)(d.A,{variant:"all"===C?"contained":"outlined",startIcon:(0,te.jsx)($.A,{}),onClick:()=>w("all"),sx:{minHeight:A?44:"auto"},children:"\u5411\u5168\u4f53\u8463\u4e8b\u63d0\u95ee"}),(0,te.jsx)(d.A,{variant:"specific"===C?"contained":"outlined",startIcon:(0,te.jsx)(E.A,{}),onClick:()=>w("specific"),sx:{minHeight:A?44:"auto"},children:"\u5411\u6307\u5b9a\u8463\u4e8b\u63d0\u95ee"})]})]}),"specific"===C&&(0,te.jsx)(x.A,{sx:{mb:2},children:(0,te.jsxs)(J.A,{fullWidth:!0,size:A?"medium":"small",children:[(0,te.jsx)(Y.A,{children:"\u9009\u62e9\u8463\u4e8b"}),(0,te.jsx)(G.A,{value:k,onChange:e=>S(e.target.value),disabled:y,label:"\u9009\u62e9\u8463\u4e8b",children:o.map(e=>{var t,n,s;return(0,te.jsx)(Z.A,{value:e.director_id,children:(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,te.jsx)(m.A,{src:null===(t=e.director)||void 0===t?void 0:t.avatar_url,sx:{width:24,height:24},children:(0,te.jsx)(E.A,{sx:{fontSize:14}})}),(0,te.jsxs)(l.A,{children:[null===(n=e.director)||void 0===n?void 0:n.name," - ",null===(s=e.director)||void 0===s?void 0:s.title]})]})},e.director_id)})})]})}),(0,te.jsxs)(x.A,{display:"flex",alignItems:A?"stretch":"center",gap:2,flexDirection:A?"column":"row",children:[(0,te.jsx)(Q.A,{size:A?"medium":"small",placeholder:"\u4f60\u7684\u79f0\u547c\uff08\u53ef\u9009\uff09",value:p,onChange:e=>f(e.target.value),sx:{width:A?"100%":150},disabled:y,fullWidth:A}),(0,te.jsx)(d.A,{type:"submit",variant:"contained",startIcon:y?(0,te.jsx)(V.A,{size:16}):(0,te.jsx)(ee.A,{}),disabled:!g.trim()||y,sx:{ml:A?0:"auto",minHeight:A?48:"auto"},size:A?"large":"medium",fullWidth:A,children:y?"\u63d0\u95ee\u4e2d...":"\u63d0\u95ee"})]})]})}),!v&&(0,te.jsx)(x.A,{textAlign:"center",children:(0,te.jsx)(h.A,{label:"\u70b9\u51fb\u5c55\u5f00\u63d0\u95ee\u6846",variant:"outlined",onClick:()=>_(!0),sx:{cursor:"pointer",minHeight:A?44:"auto",fontSize:A?"0.95rem":"0.875rem",px:A?2:1},size:A?"medium":"small"})})]})};var se=n(4616),ie=n(6986),re=n(5546),oe=n(4690),ae=n(7443),le=n(5965);const ce=e=>{let{statementId:t,responseId:n,favoriteType:i="statement",isFavorited:r=!1,onFavoriteChange:o}=e;const[a,c]=(0,s.useState)(!1),[m,A]=(0,s.useState)([]),[g,j]=(0,s.useState)(""),[v,_]=(0,s.useState)(""),[C,w]=(0,s.useState)(!1),k=async()=>{o&&o(!1),O.Ay.success("\u5df2\u53d6\u6d88\u6536\u85cf")},S=()=>{g.trim()&&!m.includes(g.trim())&&(A([...m,g.trim()]),j(""))};return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(u.A,{size:"small",onClick:()=>{r?k():c(!0)},color:r?"error":"default",title:r?"\u53d6\u6d88\u6536\u85cf":"\u6536\u85cf\u6b64\u5185\u5bb9",children:r?(0,te.jsx)(ae.A,{}):(0,te.jsx)(le.A,{})}),(0,te.jsxs)(p.A,{open:a,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,children:[(0,te.jsx)(f.A,{children:"\u6536\u85cf\u7cbe\u5f69\u5185\u5bb9"}),(0,te.jsxs)(y.A,{children:[(0,te.jsxs)(x.A,{sx:{mb:3},children:[(0,te.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"\u6dfb\u52a0\u6807\u7b7e\uff08\u53ef\u9009\uff09"}),(0,te.jsxs)(x.A,{sx:{display:"flex",gap:1,mb:2},children:[(0,te.jsx)(Q.A,{size:"small",placeholder:"\u8f93\u5165\u6807\u7b7e...",value:g,onChange:e=>j(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),S())},sx:{flex:1}}),(0,te.jsx)(d.A,{onClick:S,disabled:!g.trim(),variant:"outlined",size:"small",children:"\u6dfb\u52a0"})]}),m.length>0&&(0,te.jsx)(x.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:m.map(e=>(0,te.jsx)(h.A,{label:e,onDelete:()=>{return t=e,void A(m.filter(e=>e!==t));var t},size:"small",color:"primary",variant:"outlined"},e))})]}),(0,te.jsx)(Q.A,{fullWidth:!0,multiline:!0,rows:3,placeholder:"\u6dfb\u52a0\u6536\u85cf\u5907\u6ce8\uff08\u53ef\u9009\uff09...",value:v,onChange:e=>_(e.target.value),label:"\u6536\u85cf\u5907\u6ce8"}),(0,te.jsx)(x.A,{sx:{mt:2},children:(0,te.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"\u5efa\u8bae\u6807\u7b7e\uff1a\u91d1\u53e5\u3001\u6df1\u5ea6\u3001\u4e89\u8bae\u3001\u542f\u53d1\u3001\u7ecf\u5178"})})]}),(0,te.jsxs)(b.A,{children:[(0,te.jsx)(d.A,{onClick:()=>c(!1),children:"\u53d6\u6d88"}),(0,te.jsx)(d.A,{onClick:async()=>{w(!0);try{const e=await fetch("https://dongshihui-api.jieshu2023.workers.dev/favorites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({statement_id:t,response_id:n,favorite_type:i,tags:m,notes:v.trim(),user_id:"default_user"})}),s=await e.json();s.success?(O.Ay.success("\u6536\u85cf\u6210\u529f\uff01"),c(!1),o&&o(!0),A([]),_(""),j("")):O.Ay.error(s.error||"\u6536\u85cf\u5931\u8d25")}catch(e){console.error("\u6536\u85cf\u5931\u8d25:",e),O.Ay.error("\u6536\u85cf\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{w(!1)}},variant:"contained",disabled:C,children:C?"\u6536\u85cf\u4e2d...":"\u786e\u8ba4\u6536\u85cf"})]})]})]})},de=e=>{let{questions:t=[],onQuestionsUpdate:n}=e;return 0===t.length?(0,te.jsx)(x.A,{textAlign:"center",py:3,children:(0,te.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"\u8fd8\u6ca1\u6709\u7528\u6237\u63d0\u95ee\uff0c\u6210\u4e3a\u7b2c\u4e00\u4e2a\u63d0\u95ee\u7684\u4eba\u5427\uff01"})}):(0,te.jsxs)(x.A,{children:[(0,te.jsxs)(l.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",mb:2},children:[(0,te.jsx)(K.A,{sx:{mr:1}}),"\u7528\u6237\u63d0\u95ee (",t.length,")"]}),t.map(e=>(0,te.jsxs)(se.A,{sx:{mb:2},children:[(0,te.jsx)(ie.A,{expandIcon:(0,te.jsx)(X.A,{}),children:(0,te.jsxs)(x.A,{sx:{width:"100%"},children:[(0,te.jsxs)(x.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,te.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:500},children:e.question}),(0,te.jsxs)(x.A,{display:"flex",alignItems:"center",gap:1,children:[(0,te.jsx)(h.A,{label:e.asker_name||"\u7528\u6237",size:"small",icon:(0,te.jsx)(E.A,{}),variant:"outlined"}),(0,te.jsx)(h.A,{label:"answered"===e.status?"\u5df2\u56de\u5e94":"\u5f85\u56de\u5e94",size:"small",color:"answered"===e.status?"success":"warning"})]})]}),(0,te.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{mt:.5},children:e.created_at?(0,oe.A)(new Date(e.created_at),{addSuffix:!0,locale:q.A}):"\u65f6\u95f4\u672a\u77e5"})]})}),(0,te.jsx)(re.A,{children:e.responses&&e.responses.length>0?(0,te.jsxs)(x.A,{children:[(0,te.jsxs)(l.A,{variant:"body2",color:"info.main",sx:{fontStyle:"italic"},children:["\u2705 \u8463\u4e8b\u4eec\u5df2\u5728\u4f1a\u8bae\u8ba8\u8bba\u8bb0\u5f55\u4e2d\u56de\u590d\u4e86\u6b64\u95ee\u9898 (",e.responses.length,"\u4f4d\u8463\u4e8b\u56de\u590d)"]}),(0,te.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:'\u8bf7\u5728\u5de6\u4fa7\u7684"\u4f1a\u8bae\u8ba8\u8bba\u8bb0\u5f55"\u4e2d\u67e5\u770b\u8463\u4e8b\u4eec\u7684\u8be6\u7ec6\u56de\u590d\u5185\u5bb9\u3002'})]}):(0,te.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:"\u8463\u4e8b\u4eec\u8fd8\u672a\u56de\u5e94\u6b64\u95ee\u9898"})})]},e.id))]})};var xe=n(7222),he=n(6904);const ue=e=>{var t;let{statementId:n,onClose:i}=e;const[r,o]=(0,s.useState)(null),[c,A]=(0,s.useState)(!0),[g,j]=(0,s.useState)(!1),f=(0,s.useRef)(null);s.useEffect(()=>{n&&b()},[n]);const b=async()=>{try{const e=await fetch("https://dongshihui-api.jieshu2023.workers.dev/statements/".concat(n,"/card")),t=await e.json();t.success?o(t.data):(console.error("\u5361\u7247API\u8fd4\u56de\u9519\u8bef:",t.error),o({id:n,content:"\u8fd9\u662f\u4e00\u4e2a\u6d4b\u8bd5\u91d1\u53e5\uff0c\u7528\u4e8e\u6f14\u793a\u957f\u56fe\u5206\u4eab\u529f\u80fd\u3002",director:{name:"\u6d4b\u8bd5\u8463\u4e8b",title:"AI\u6d4b\u8bd5\u4e13\u5bb6",avatar_url:null,era:"2024\u5e74"},meeting:{title:"\u6d4b\u8bd5\u4f1a\u8bae",topic:"\u6d4b\u8bd5\u957f\u56fe\u5206\u4eab\u529f\u80fd"},analysis:{keywords:["\u6d4b\u8bd5","\u957f\u56fe","\u5206\u4eab"],theme_color:"#1976d2",category:"\u6d4b\u8bd5",highlight_quote:"\u8fd9\u662f\u4e00\u4e2a\u6d4b\u8bd5\u91d1\u53e5"},created_at:(new Date).toISOString(),round_number:1}),O.Ay.error("\u83b7\u53d6\u5361\u7247\u6570\u636e\u5931\u8d25\uff0c\u4f7f\u7528\u6d4b\u8bd5\u6570\u636e"))}catch(e){console.error("\u83b7\u53d6\u5361\u7247\u6570\u636e\u5931\u8d25:",e),o({id:n,content:"\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8fd9\u662f\u6d4b\u8bd5\u6570\u636e\u7528\u4e8e\u6f14\u793a\u957f\u56fe\u5206\u4eab\u529f\u80fd\u3002",director:{name:"\u6d4b\u8bd5\u8463\u4e8b",title:"\u7cfb\u7edf\u6d4b\u8bd5\u5458",avatar_url:null,era:"\u73b0\u4ee3"},meeting:{title:"\u6d4b\u8bd5\u4f1a\u8bae",topic:"\u7f51\u7edc\u9519\u8bef\u5904\u7406\u6d4b\u8bd5"},analysis:{keywords:["\u7f51\u7edc","\u9519\u8bef","\u6d4b\u8bd5"],theme_color:"#f44336",category:"\u9519\u8bef",highlight_quote:"\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\u65f6\u7684\u5904\u7406"},created_at:(new Date).toISOString(),round_number:1}),O.Ay.error("\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u4f7f\u7528\u6d4b\u8bd5\u6570\u636e")}finally{A(!1)}},v=async()=>{if(!r)return;console.log("=== \u8c03\u8bd5\u6570\u636e\u6e90 ==="),console.log("highlight_quote:",r.analysis.highlight_quote),console.log("content:",r.content),console.log("director.name:",r.director.name),console.log("meeting.title:",r.meeting.title);const e=e=>!("string"!==typeof e||!e.includes("&::after"))&&(console.error("\u53d1\u73b0CSS\u5b57\u7b26:",e),!0);e(r.analysis.highlight_quote),e(r.content),e(r.director.name),e(r.meeting.title),j(!0);try{const e=document.createElement("canvas"),t=e.getContext("2d"),n=2,s=480,i=600;e.width=s*n,e.height=i*n,e.style.width=s+"px",e.style.height=i+"px",t.scale(n,n);const o=t.createLinearGradient(0,0,s,i);o.addColorStop(0,"rgba(25, 118, 210, 0.1)"),o.addColorStop(1,"rgba(25, 118, 210, 0.05)"),t.fillStyle=o,t.fillRect(0,0,s,i),t.strokeStyle="#1976d2",t.lineWidth=2,t.strokeRect(1,1,s-2,i-2),t.fillStyle="rgba(25, 118, 210, 0.05)",t.beginPath(),t.arc(s-50,50,80,0,2*Math.PI),t.fill();let a=40;t.fillStyle="#1976d2",t.fillRect(30,a,100,28),t.fillStyle="#ffffff",t.font="bold 14px sans-serif",t.textAlign="center";const l=(r.analysis.category||"\u53d1\u8a00").replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a]/g,"");t.fillText(l,80,a+18),t.font="12px sans-serif",t.fillStyle="#666666",t.textAlign="right",t.fillText("\u7b2c".concat(r.round_number,"\u8f6e\u53d1\u8a00"),s-30,a+18),a+=50,t.fillStyle="#1976d2",t.beginPath(),t.arc(70,a+30,30,0,2*Math.PI),t.fill(),t.fillStyle="#ffffff",t.font="bold 20px sans-serif",t.textAlign="center";const c=r.director.name?r.director.name[0]:"A";t.fillText(c,70,a+38),t.textAlign="left",t.fillStyle="#000000",t.font="bold 20px sans-serif";const d=(r.director.name||"\u533f\u540d\u8463\u4e8b").replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a]/g,"");t.fillText(d,110,a+20),t.font="16px sans-serif",t.fillStyle="#666666";const x=(r.director.title||"\u8463\u4e8b\u4f1a\u6210\u5458").replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a]/g,"");t.fillText(x,110,a+42),t.font="14px sans-serif";const h=(r.director.era||"\u73b0\u4ee3").replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a]/g,"");t.fillText(h,110,a+60),a+=100,t.fillStyle="rgba(255, 255, 255, 0.9)";const u=120;t.fillRect(30,a,s-60,u);const m=(r.analysis.highlight_quote||r.content||"\u7cbe\u5f69\u53d1\u8a00").replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a\u3000-\u303f\uff00-\uffef\s.,!?;:()"""''\uff0c\u3002\uff01\uff1f\uff1b\uff1a\uff08\uff09]/g,"").trim();t.fillStyle="#1976d2",t.font="bold 18px sans-serif",t.textAlign="center";const A=18,g=Math.floor((s-120)/A),j=[];console.log("\u6587\u672c\u6362\u884c - \u539f\u6587:",m),console.log("\u6bcf\u884c\u6700\u5927\u5b57\u7b26\u6570:",g);for(let r=0;r<m.length;r+=g){const e=m.slice(r,r+g);j.push(e),console.log("\u884c",j.length,":",e)}const p=24,f=a+(u-j.length*p)/2+18;j.forEach((e,n)=>{t.fillText(e,s/2,f+n*p)}),a+=u+30,t.font="14px sans-serif",t.fillStyle="#666666";const y=(r.meeting.title||"\u672a\u77e5\u4f1a\u8bae").replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a\s]/g,"");t.fillText("\u6765\u81ea\u4f1a\u8bae\uff1a".concat(y),s/2,a);const b=(0,L.A)(new Date(r.created_at),"yyyy\u5e74MM\u6708dd\u65e5",{locale:q.A});return t.fillText(b,s/2,a+20),a+=50,t.strokeStyle="#e0e0e0",t.lineWidth=1,t.beginPath(),t.moveTo(30,a),t.lineTo(s-30,a),t.stroke(),a+=20,t.font="bold 16px sans-serif",t.fillStyle="#1976d2",t.fillText("\u79c1\u4eba\u8463\u4e8b\u4f1a",s/2,a),t.font="12px sans-serif",t.fillStyle="#666666",t.fillText("dongshihui.xyz \u4e0e\u5386\u53f2\u4eba\u7269\u5171\u5546\u5927\u4e8b",s/2,a+20),e}catch(t){return console.error("\u751f\u6210\u56fe\u7247\u5931\u8d25:",t),O.Ay.error("\u751f\u6210\u56fe\u7247\u5931\u8d25"),null}finally{j(!1)}},_=async()=>{const e=await v();if(e)try{e.toBlob(e=>{const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="\u91d1\u53e5\u5361\u7247-".concat(r.director.name,"-").concat((0,L.A)(new Date(r.created_at),"yyyyMMdd-HHmm"),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),O.Ay.success("\u957f\u56fe\u5df2\u4e0b\u8f7d\u5230\u672c\u5730")},"image/png",1)}catch(t){console.error("\u4e0b\u8f7d\u56fe\u7247\u5931\u8d25:",t),O.Ay.error("\u4e0b\u8f7d\u5931\u8d25")}};return c?(0,te.jsx)(p.A,{open:!0,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,te.jsxs)(y.A,{sx:{textAlign:"center",py:4},children:[(0,te.jsx)(V.A,{}),(0,te.jsx)(l.A,{variant:"body2",sx:{mt:2},children:"\u6b63\u5728\u751f\u6210\u91d1\u53e5\u5361\u7247..."})]})}):r?(0,te.jsx)(p.A,{open:!0,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,te.jsx)(y.A,{sx:{p:0},children:(0,te.jsxs)(x.A,{sx:{position:"relative"},children:[(0,te.jsx)(u.A,{sx:{position:"absolute",top:8,right:8,zIndex:1},onClick:i,children:(0,te.jsx)(R.A,{})}),(0,te.jsxs)(a.A,{ref:f,sx:{p:4,background:"linear-gradient(135deg, ".concat(r.analysis.theme_color,"22 0%, ").concat(r.analysis.theme_color,"11 100%)"),border:"2px solid ".concat(r.analysis.theme_color),borderRadius:3,position:"relative",overflow:"hidden",width:480,minHeight:600,margin:"0 auto"},children:[(0,te.jsx)(x.A,{sx:{position:"absolute",top:-50,right:-50,width:200,height:200,background:"radial-gradient(circle, ".concat(r.analysis.theme_color,"15 0%, transparent 70%)"),borderRadius:"50%"}}),(0,te.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,te.jsx)(h.A,{label:r.analysis.category,sx:{backgroundColor:r.analysis.theme_color,color:"white",fontWeight:"bold"}}),(0,te.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["\u7b2c",r.round_number,"\u8f6e\u53d1\u8a00"]})]}),(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,te.jsx)(m.A,{src:r.director.avatar_url,sx:{width:60,height:60,mr:2,border:"3px solid ".concat(r.analysis.theme_color)},children:null===(t=r.director.name)||void 0===t?void 0:t[0]}),(0,te.jsxs)(x.A,{children:[(0,te.jsx)(l.A,{variant:"h6",fontWeight:"bold",children:r.director.name}),(0,te.jsx)(l.A,{variant:"subtitle2",color:"text.secondary",children:r.director.title}),(0,te.jsx)(l.A,{variant:"caption",color:"text.secondary",children:r.director.era})]})]}),(0,te.jsx)(x.A,{sx:{textAlign:"center",mb:3,p:3,backgroundColor:"rgba(255,255,255,0.9)",borderRadius:2,position:"relative"},children:(0,te.jsx)(l.A,{variant:"h6",sx:{fontStyle:"italic",lineHeight:1.4,color:r.analysis.theme_color,fontWeight:500,position:"relative"},children:r.analysis.highlight_quote||r.content})}),r.analysis.keywords.length>0&&(0,te.jsx)(x.A,{sx:{mb:3,textAlign:"center"},children:r.analysis.keywords.map((e,t)=>(0,te.jsx)(h.A,{label:e,size:"small",variant:"outlined",sx:{mr:.5,mb:.5,borderColor:r.analysis.theme_color,color:r.analysis.theme_color}},t))}),(0,te.jsxs)(x.A,{sx:{textAlign:"center",mb:2},children:[(0,te.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\u6765\u81ea\u4f1a\u8bae\uff1a",r.meeting.title]}),(0,te.jsx)(l.A,{variant:"caption",color:"text.secondary",children:(0,L.A)(new Date(r.created_at),"yyyy\u5e74MM\u6708dd\u65e5",{locale:q.A})})]}),(0,te.jsxs)(x.A,{sx:{textAlign:"center",borderTop:1,borderColor:"divider",pt:2,mt:2},children:[(0,te.jsx)(l.A,{variant:"body2",color:"text.secondary",fontWeight:"bold",sx:{mb:1},children:"\u79c1\u4eba\u8463\u4e8b\u4f1a"}),(0,te.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"dongshihui.xyz \u4e0e\u5386\u53f2\u4eba\u7269\u5171\u5546\u5927\u4e8b"})]})]}),(0,te.jsxs)(x.A,{sx:{display:"flex",justifyContent:"center",gap:1.5,mt:3,pb:2,flexWrap:"wrap"},children:[(0,te.jsx)(d.A,{variant:"contained",startIcon:g?(0,te.jsx)(V.A,{size:16,color:"inherit"}):(0,te.jsx)(xe.A,{}),onClick:async()=>{const e=await v();if(e)try{navigator.share&&navigator.canShare?e.toBlob(async e=>{const t=new File([e],"\u91d1\u53e5\u5361\u7247-".concat(r.director.name,".png"),{type:"image/png"});if(navigator.canShare({files:[t]}))try{await navigator.share({title:"".concat(r.director.name,"\u7684\u91d1\u53e5"),text:'"'.concat(r.analysis.highlight_quote||r.content,'" \u2014\u2014 ').concat(r.director.name),files:[t]})}catch(n){await _()}else await _()},"image/png",1):await _()}catch(t){console.error("\u5206\u4eab\u56fe\u7247\u5931\u8d25:",t),O.Ay.error("\u5206\u4eab\u5931\u8d25")}},disabled:g,sx:{backgroundColor:r.analysis.theme_color,minWidth:120},children:g?"\u751f\u6210\u4e2d...":"\u5206\u4eab\u957f\u56fe"}),(0,te.jsx)(d.A,{variant:"outlined",startIcon:(0,te.jsx)(he.A,{}),onClick:async()=>{if(!r)return;const e="\u3010".concat(r.director.name,"\u3011").concat(r.director.title,'\n\n"').concat(r.analysis.highlight_quote||r.content,'"\n\n\u6765\u81ea\u79c1\u4eba\u8463\u4e8b\u4f1a\u7cfb\u7edf - ').concat(r.meeting.title);if(navigator.share)try{await navigator.share({title:"".concat(r.director.name,"\u7684\u91d1\u53e5"),text:e,url:window.location.origin})}catch(t){}else try{await navigator.clipboard.writeText(e),O.Ay.success("\u5185\u5bb9\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f")}catch(t){O.Ay.error("\u5206\u4eab\u5931\u8d25")}},sx:{borderColor:r.analysis.theme_color,color:r.analysis.theme_color,minWidth:100},children:"\u5206\u4eab\u6587\u672c"}),(0,te.jsx)(d.A,{variant:"outlined",startIcon:(0,te.jsx)(I.A,{}),onClick:async()=>{if(r&&f.current)try{const e="".concat(r.director.name,"\uff08").concat(r.director.title,'\uff09\n\n"').concat(r.content,'"\n\n\u6765\u81ea\u4f1a\u8bae\uff1a').concat(r.meeting.title,"\n\u8bdd\u9898\uff1a").concat(r.meeting.topic,"\n\u53d1\u8a00\u65f6\u95f4\uff1a").concat((0,L.A)(new Date(r.created_at),"yyyy\u5e74MM\u6708dd\u65e5 HH:mm",{locale:q.A}),"\n\n\u5173\u952e\u8bcd\uff1a").concat(r.analysis.keywords.join(", "),"\n\u5206\u7c7b\uff1a").concat(r.analysis.category,"\n\n\u2014\u2014 \u79c1\u4eba\u8463\u4e8b\u4f1a\u7cfb\u7edf");await navigator.clipboard.writeText(e),O.Ay.success("\u5361\u7247\u5185\u5bb9\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f")}catch(e){O.Ay.error("\u590d\u5236\u5931\u8d25")}},sx:{borderColor:r.analysis.theme_color,color:r.analysis.theme_color,minWidth:100},children:"\u590d\u5236\u5185\u5bb9"})]})]})})}):(0,te.jsx)(p.A,{open:!0,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,te.jsxs)(y.A,{sx:{textAlign:"center",py:4},children:[(0,te.jsx)(l.A,{variant:"body1",color:"error",children:"\u5361\u7247\u751f\u6210\u5931\u8d25"}),(0,te.jsx)(d.A,{onClick:i,sx:{mt:2},children:"\u5173\u95ed"})]})})};var me=n(249),Ae=n(4446),ge=n(3563),je=n(1769),pe=n(920),fe=n(6191),ye=n(6299),be=n(5699),ve=n(8517),_e=n(1113),Ce=n(1052),we=n.n(Ce);const ke=e=>{let{meetingId:t,meetingTitle:n,onClose:i}=e;const[r,o]=(0,s.useState)(null),[c,h]=(0,s.useState)(!1),[u,m]=(0,s.useState)(!1),[g,j]=(0,s.useState)(!1),v=(0,s.useRef)(null),_=async()=>{if(r&&v.current){j(!0);try{const e=document.createElement("div");e.style.cssText="\n        width: 600px;\n        min-height: 800px;\n        padding: 0;\n        background: #ffffff;\n        position: relative;\n        overflow: hidden;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;\n        color: #333;\n        box-sizing: border-box;\n      ",e.innerHTML='\n        <div style="background: #1976d2; color: white; padding: 20px 0; text-align: center;">\n          <div style="font-size: 24px; font-weight: bold; margin-bottom: 8px;">\u4f1a\u8baeAI\u6458\u8981</div>\n          <div style="font-size: 16px;">'.concat(n.replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a\s]/g,""),'</div>\n        </div>\n        \n        <div style="text-align: center; padding: 12px 0; font-size: 12px; color: #999;">\n          \u751f\u6210\u65f6\u95f4\uff1a').concat((0,L.A)(new Date,"yyyy\u5e74MM\u6708dd\u65e5 HH:mm",{locale:q.A}),'\n        </div>\n        \n        <div style="margin: 20px 30px; padding: 20px; background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px;">\n          <div style="font-size: 16px; font-weight: bold; color: #1976d2; margin-bottom: 12px;">\u25a0 \u6267\u884c\u6458\u8981</div>\n          <div style="font-size: 14px; line-height: 1.5; color: #333;">\n            ').concat(r.executive_summary.replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a\u3000-\u303f\uff00-\uffef\s.,!?;:()"""''\uff0c\u3002\uff01\uff1f\uff1b\uff1a\uff08\uff09]/g,"").substring(0,200),'...\n          </div>\n        </div>\n        \n        <div style="margin: 20px 30px;">\n          <div style="font-size: 16px; font-weight: bold; color: #1976d2; margin-bottom: 12px;">\u2022 \u5173\u952e\u8981\u70b9</div>\n          ').concat(r.key_points.slice(0,5).map((e,t)=>'<div style="font-size: 14px; margin-bottom: 8px; color: #333;">\n              '.concat(t+1,". ").concat(e.replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a\u3000-\u303f\uff00-\uffef\s.,!?;:()"""''\uff0c\u3002\uff01\uff1f\uff1b\uff1a\uff08\uff09]/g,"").substring(0,80),"\n            </div>")).join(""),'\n        </div>\n        \n        <div style="margin: 20px 30px;">\n          <div style="font-size: 16px; font-weight: bold; color: #1976d2; margin-bottom: 12px;">\u25c6 \u8463\u4e8b\u4eae\u70b9</div>\n          ').concat(r.participant_highlights.slice(0,4).map(e=>'<div style="margin-bottom: 12px;">\n              <div style="font-size: 14px; font-weight: bold; color: #1976d2; margin-bottom: 4px;">\n                > '.concat(e.director.replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a]/g,""),':\n              </div>\n              <div style="font-size: 14px; color: #333; margin-left: 16px;">\n                ').concat(e.key_contribution.replace(/[^\u4e00-\u9fff\u0030-\u0039\u0041-\u005a\u0061-\u007a\u3000-\u303f\uff00-\uffef\s.,!?;:()"""''\uff0c\u3002\uff01\uff1f\uff1b\uff1a\uff08\uff09]/g,"").substring(0,100),"\n              </div>\n            </div>")).join(""),'\n        </div>\n        \n        <div style="border-top: 2px solid #e0e0e0; margin: 30px 30px 0 30px; padding-top: 20px; text-align: center;">\n          <div style="font-size: 18px; font-weight: bold; color: #1976d2; margin-bottom: 8px;">\n            \u79c1\u4eba\u8463\u4e8b\u4f1a\n          </div>\n          <div style="font-size: 14px; color: #666; margin-bottom: 4px;">\n            dongshihui.xyz \u4e0e\u5386\u53f2\u4eba\u7269\u5171\u5546\u5927\u4e8b\n          </div>\n          <div style="font-size: 12px; color: #999;">\n            \u672c\u6458\u8981\u7531Claude Sonnet 4 AI\u81ea\u52a8\u751f\u6210\n          </div>\n        </div>\n      '),e.style.position="fixed",e.style.top="-9999px",e.style.left="-9999px",document.body.appendChild(e);const t=await we()(e,{backgroundColor:"#ffffff",scale:2,useCORS:!0,allowTaint:!1,foreignObjectRendering:!1,removeContainer:!0,imageTimeout:0,logging:!1,width:600,height:Math.max(800,e.offsetHeight),onclone:function(e){const t=e.createElement("style");t.textContent="\n            *::before, *::after {\n              content: none !important;\n              display: none !important;\n            }\n            * {\n              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif !important;\n            }\n          ",e.head.appendChild(t)}});return document.body.removeChild(e),t}catch(e){return console.error("\u751f\u6210\u6458\u8981\u957f\u56fe\u5931\u8d25:",e),O.Ay.error("\u751f\u6210\u6458\u8981\u957f\u56fe\u5931\u8d25"),null}finally{j(!1)}}},C=async()=>{const e=await _();if(e)try{e.toBlob(e=>{const t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="\u4f1a\u8bae\u6458\u8981-".concat(n,"-").concat((0,L.A)(new Date,"yyyyMMdd-HHmm"),".png"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t),O.Ay.success("\u6458\u8981\u957f\u56fe\u5df2\u4e0b\u8f7d\u5230\u672c\u5730")},"image/png",1)}catch(t){console.error("\u4e0b\u8f7d\u6458\u8981\u56fe\u7247\u5931\u8d25:",t),O.Ay.error("\u4e0b\u8f7d\u5931\u8d25")}};return(0,te.jsxs)(p.A,{open:!0,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,te.jsx)(f.A,{children:(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,te.jsx)(l.A,{variant:"h6",children:"\u4f1a\u8baeAI\u6458\u8981"}),(0,te.jsx)(l.A,{variant:"subtitle2",color:"text.secondary",children:n})]})}),(0,te.jsx)(y.A,{children:u?r&&(0,te.jsxs)(x.A,{ref:v,sx:{p:3,backgroundColor:"#ffffff",minHeight:"600px"},children:[(0,te.jsxs)(x.A,{sx:{textAlign:"center",mb:4,borderBottom:"3px solid #1976d2",pb:2},children:[(0,te.jsx)(l.A,{variant:"h4",sx:{fontWeight:"bold",color:"#1976d2",mb:1},children:"\u4f1a\u8baeAI\u6458\u8981"}),(0,te.jsx)(l.A,{variant:"h6",sx:{color:"#666",mb:1},children:n}),(0,te.jsxs)(l.A,{variant:"body2",sx:{color:"#999"},children:["\u751f\u6210\u65f6\u95f4\uff1a",(0,L.A)(new Date,"yyyy\u5e74MM\u6708dd\u65e5 HH:mm",{locale:q.A})]})]}),(0,te.jsxs)(a.A,{sx:{p:3,mb:3,backgroundColor:"#f8f9fa",border:"1px solid #e0e0e0"},children:[(0,te.jsx)(l.A,{variant:"h6",gutterBottom:!0,sx:{color:"#1976d2",fontWeight:"bold"},children:"\ud83d\udccb \u6267\u884c\u6458\u8981"}),(0,te.jsx)(l.A,{variant:"body1",sx:{lineHeight:1.6,color:"#333"},children:r.executive_summary})]}),(0,te.jsxs)(A.Ay,{container:!0,spacing:3,children:[(0,te.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,te.jsxs)(a.A,{sx:{p:2,height:"100%"},children:[(0,te.jsxs)(l.A,{variant:"subtitle1",gutterBottom:!0,children:[(0,te.jsx)(pe.A,{sx:{mr:1,verticalAlign:"middle"}}),"\u5173\u952e\u8981\u70b9"]}),(0,te.jsx)(me.A,{dense:!0,children:r.key_points.map((e,t)=>(0,te.jsx)(Ae.Ay,{children:(0,te.jsx)(ge.A,{primary:"".concat(t+1,". ").concat(e)})},t))})]})}),(0,te.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,te.jsxs)(a.A,{sx:{p:2,height:"100%"},children:[(0,te.jsxs)(l.A,{variant:"subtitle1",gutterBottom:!0,children:[(0,te.jsx)(fe.A,{sx:{mr:1,verticalAlign:"middle"}}),"\u8463\u4e8b\u4eae\u70b9"]}),(0,te.jsx)(me.A,{dense:!0,children:r.participant_highlights.map((e,t)=>(0,te.jsx)(Ae.Ay,{children:(0,te.jsx)(ge.A,{primary:e.director,secondary:e.key_contribution})},t))})]})}),(0,te.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,te.jsxs)(a.A,{sx:{p:2},children:[(0,te.jsxs)(l.A,{variant:"subtitle1",gutterBottom:!0,color:"success.main",children:[(0,te.jsx)(ye.A,{sx:{mr:1,verticalAlign:"middle"}}),"\u8fbe\u6210\u5171\u8bc6"]}),r.agreements.length>0?(0,te.jsx)(me.A,{dense:!0,children:r.agreements.map((e,t)=>(0,te.jsx)(Ae.Ay,{children:(0,te.jsx)(ge.A,{primary:"\u2022 ".concat(e)})},t))}):(0,te.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"\u6682\u65e0\u660e\u786e\u5171\u8bc6"})]})}),(0,te.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,te.jsxs)(a.A,{sx:{p:2},children:[(0,te.jsxs)(l.A,{variant:"subtitle1",gutterBottom:!0,color:"warning.main",children:[(0,te.jsx)(be.A,{sx:{mr:1,verticalAlign:"middle"}}),"\u4e89\u8bae\u5206\u6b67"]}),r.disagreements.length>0?(0,te.jsx)(me.A,{dense:!0,children:r.disagreements.map((e,t)=>(0,te.jsx)(Ae.Ay,{children:(0,te.jsx)(ge.A,{primary:"\u2022 ".concat(e)})},t))}):(0,te.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"\u6682\u65e0\u91cd\u5927\u5206\u6b67"})]})}),r.insights.length>0&&(0,te.jsx)(A.Ay,{item:!0,xs:12,children:(0,te.jsxs)(a.A,{sx:{p:2},children:[(0,te.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,color:"info.main",children:"\ud83d\udca1 \u6df1\u5ea6\u6d1e\u5bdf"}),(0,te.jsx)(me.A,{dense:!0,children:r.insights.map((e,t)=>(0,te.jsx)(Ae.Ay,{children:(0,te.jsx)(ge.A,{primary:"\u2022 ".concat(e)})},t))})]})}),(0,te.jsx)(A.Ay,{item:!0,xs:12,children:(0,te.jsxs)(a.A,{sx:{p:2},children:[(0,te.jsxs)(l.A,{variant:"subtitle1",gutterBottom:!0,children:[(0,te.jsx)(ve.A,{sx:{mr:1,verticalAlign:"middle"}}),"\u8ba8\u8bba\u8d28\u91cf\u8bc4\u5206"]}),(0,te.jsxs)(A.Ay,{container:!0,spacing:2,children:[(0,te.jsx)(A.Ay,{item:!0,xs:4,children:(0,te.jsxs)(x.A,{textAlign:"center",children:[(0,te.jsx)(l.A,{variant:"body2",gutterBottom:!0,children:"\u8ba8\u8bba\u6df1\u5ea6"}),(0,te.jsx)(je.A,{value:r.rating.depth/2,precision:.5,readOnly:!0}),(0,te.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[r.rating.depth,"/10"]})]})}),(0,te.jsx)(A.Ay,{item:!0,xs:4,children:(0,te.jsxs)(x.A,{textAlign:"center",children:[(0,te.jsx)(l.A,{variant:"body2",gutterBottom:!0,children:"\u4e89\u8bae\u7a0b\u5ea6"}),(0,te.jsx)(je.A,{value:r.rating.controversy/2,precision:.5,readOnly:!0}),(0,te.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[r.rating.controversy,"/10"]})]})}),(0,te.jsx)(A.Ay,{item:!0,xs:4,children:(0,te.jsxs)(x.A,{textAlign:"center",children:[(0,te.jsx)(l.A,{variant:"body2",gutterBottom:!0,children:"\u6d1e\u5bdf\u4ef7\u503c"}),(0,te.jsx)(je.A,{value:r.rating.insight/2,precision:.5,readOnly:!0}),(0,te.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[r.rating.insight,"/10"]})]})})]})]})}),r.next_steps.length>0&&(0,te.jsx)(A.Ay,{item:!0,xs:12,children:(0,te.jsxs)(a.A,{sx:{p:2},children:[(0,te.jsxs)(l.A,{variant:"subtitle1",gutterBottom:!0,children:[(0,te.jsx)(_e.A,{sx:{mr:1,verticalAlign:"middle"}}),"\u540e\u7eed\u63a2\u8ba8\u65b9\u5411"]}),(0,te.jsx)(me.A,{dense:!0,children:r.next_steps.map((e,t)=>(0,te.jsx)(Ae.Ay,{children:(0,te.jsx)(ge.A,{primary:"".concat(t+1,". ").concat(e)})},t))})]})})]}),(0,te.jsxs)(x.A,{sx:{textAlign:"center",mt:4,pt:3,borderTop:"2px solid #e0e0e0"},children:[(0,te.jsx)(l.A,{variant:"h6",sx:{color:"#1976d2",fontWeight:"bold",mb:1},children:"\u79c1\u4eba\u8463\u4e8b\u4f1a"}),(0,te.jsx)(l.A,{variant:"body2",sx:{color:"#666"},children:"dongshihui.xyz \u4e0e\u5386\u53f2\u4eba\u7269\u5171\u5546\u5927\u4e8b"}),(0,te.jsx)(l.A,{variant:"caption",sx:{color:"#999",display:"block",mt:1},children:"\u672c\u6458\u8981\u7531Claude Sonnet 4 AI\u81ea\u52a8\u751f\u6210"})]})]}):(0,te.jsx)(x.A,{sx:{textAlign:"center",py:4},children:c?(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(V.A,{}),(0,te.jsx)(l.A,{variant:"body2",sx:{mt:2},children:"AI\u6b63\u5728\u5206\u6790\u4f1a\u8bae\u5185\u5bb9\uff0c\u751f\u6210\u667a\u80fd\u6458\u8981..."})]}):(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u751f\u6210AI\u4f1a\u8bae\u6458\u8981"}),(0,te.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"AI\u5c06\u5206\u6790\u6574\u573a\u4f1a\u8bae\u7684\u53d1\u8a00\u5185\u5bb9\uff0c\u63d0\u53d6\u5173\u952e\u89c2\u70b9\u3001\u5171\u8bc6\u5206\u6b67\u3001\u6df1\u5ea6\u6d1e\u5bdf\u7b49"}),(0,te.jsx)(d.A,{variant:"contained",size:"large",onClick:async()=>{h(!0);try{const e=await fetch("https://dongshihui-api.jieshu2023.workers.dev/meetings/".concat(t,"/summary"),{method:"POST",headers:{"Content-Type":"application/json"}}),n=await e.json();n.success?(o(n.data.summary),m(!0),O.Ay.success("\u4f1a\u8bae\u6458\u8981\u751f\u6210\u6210\u529f\uff01")):O.Ay.error(n.error||"\u751f\u6210\u6458\u8981\u5931\u8d25")}catch(e){console.error("\u751f\u6210\u6458\u8981\u5931\u8d25:",e),O.Ay.error("\u751f\u6210\u6458\u8981\u5931\u8d25")}finally{h(!1)}},startIcon:(0,te.jsx)(pe.A,{}),children:"\u5f00\u59cb\u751f\u6210\u6458\u8981"})]})})}),(0,te.jsxs)(b.A,{children:[u&&r&&(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(d.A,{startIcon:g?(0,te.jsx)(V.A,{size:16}):(0,te.jsx)(xe.A,{}),onClick:async()=>{const e=await _();if(e)try{navigator.share&&navigator.canShare?e.toBlob(async e=>{const t=new File([e],"\u4f1a\u8bae\u6458\u8981-".concat(n,".png"),{type:"image/png"});if(navigator.canShare({files:[t]}))try{await navigator.share({title:"".concat(n," - \u4f1a\u8bae\u6458\u8981"),text:r.executive_summary.substring(0,100)+"...",files:[t]})}catch(s){await C()}else await C()},"image/png",1):await C()}catch(t){console.error("\u5206\u4eab\u6458\u8981\u56fe\u7247\u5931\u8d25:",t),O.Ay.error("\u5206\u4eab\u5931\u8d25")}},disabled:g,variant:"contained",children:g?"\u751f\u6210\u4e2d...":"\u5206\u4eab\u957f\u56fe"}),(0,te.jsx)(d.A,{startIcon:(0,te.jsx)(he.A,{}),onClick:async()=>{if(!r)return;const e="\u3010".concat(n," - \u4f1a\u8bae\u6458\u8981\u3011\n\n\u6838\u5fc3\u8981\u70b9\uff1a\n").concat(r.executive_summary,"\n\n\u4e3b\u8981\u89c2\u70b9\uff1a\n").concat(r.key_points.map((e,t)=>"".concat(t+1,". ").concat(e)).join("\n"),"\n\n\u53c2\u4e0e\u8463\u4e8b\u4eae\u70b9\uff1a\n").concat(r.participant_highlights.map(e=>"\u2022 ".concat(e.director,"\uff1a").concat(e.key_contribution)).join("\n"),"\n\n\u6765\u81ea\u79c1\u4eba\u8463\u4e8b\u4f1a\u7cfb\u7edf");if(navigator.share)try{await navigator.share({title:"".concat(n," - \u4f1a\u8bae\u6458\u8981"),text:e,url:window.location.origin})}catch(t){}else try{await navigator.clipboard.writeText(e),O.Ay.success("\u6458\u8981\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f")}catch(t){O.Ay.error("\u5206\u4eab\u5931\u8d25")}},children:"\u5206\u4eab\u6587\u672c"}),(0,te.jsx)(d.A,{startIcon:(0,te.jsx)(I.A,{}),onClick:async()=>{if(!r)return;const e="\u79c1\u4eba\u8463\u4e8b\u4f1a\u7cfb\u7edf - \u4f1a\u8bae\u6458\u8981\u62a5\u544a\n\n\u4f1a\u8bae\u6807\u9898\uff1a".concat(n,"\n\u751f\u6210\u65f6\u95f4\uff1a").concat((0,L.A)(new Date,"yyyy\u5e74MM\u6708dd\u65e5 HH:mm",{locale:q.A}),"\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n\u3010\u6267\u884c\u6458\u8981\u3011\n").concat(r.executive_summary,"\n\n\u3010\u5173\u952e\u8981\u70b9\u3011\n").concat(r.key_points.map((e,t)=>"".concat(t+1,". ").concat(e)).join("\n"),"\n\n\u3010\u8fbe\u6210\u5171\u8bc6\u3011\n").concat(r.agreements.map((e,t)=>"\u2022 ".concat(e)).join("\n")||"\u6682\u65e0\u660e\u786e\u5171\u8bc6","\n\n\u3010\u4e89\u8bae\u5206\u6b67\u3011\n").concat(r.disagreements.map((e,t)=>"\u2022 ".concat(e)).join("\n")||"\u6682\u65e0\u91cd\u5927\u5206\u6b67","\n\n\u3010\u6df1\u5ea6\u6d1e\u5bdf\u3011\n").concat(r.insights.map((e,t)=>"\u2022 ".concat(e)).join("\n")||"\u6682\u65e0\u7279\u6b8a\u6d1e\u5bdf","\n\n\u3010\u53c2\u4e0e\u8463\u4e8b\u4eae\u70b9\u3011\n").concat(r.participant_highlights.map(e=>"\u2022 ".concat(e.director,"\uff08").concat(e.key_contribution,"\uff09")).join("\n"),"\n\n\u3010\u540e\u7eed\u65b9\u5411\u3011\n").concat(r.next_steps.map((e,t)=>"".concat(t+1,". ").concat(e)).join("\n")||"\u6682\u65e0\u540e\u7eed\u5efa\u8bae","\n\n\u3010\u8d28\u91cf\u8bc4\u5206\u3011\n\u8ba8\u8bba\u6df1\u5ea6\uff1a").concat(r.rating.depth,"/10\n\u4e89\u8bae\u7a0b\u5ea6\uff1a").concat(r.rating.controversy,"/10\n\u6d1e\u5bdf\u4ef7\u503c\uff1a").concat(r.rating.insight,"/10\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n\u672c\u62a5\u544a\u7531\u79c1\u4eba\u8463\u4e8b\u4f1a\u7cfb\u7edfAI\u81ea\u52a8\u751f\u6210\n\u751f\u6210\u6a21\u578b\uff1aClaude Sonnet 4");try{await navigator.clipboard.writeText(e),O.Ay.success("\u5b8c\u6574\u62a5\u544a\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f")}catch(t){O.Ay.error("\u4e0b\u8f7d\u5931\u8d25")}},children:"\u590d\u5236\u62a5\u544a"})]}),(0,te.jsx)(d.A,{onClick:i,children:"\u5173\u95ed"})]})]})};var Se=n(9277),ze=n(3114),Ie=n(975),Fe=n(5815),We=n(8629),Ee=n(7526);const He=e=>{let{meetingId:t,meetingTitle:n,statementCount:i,onClose:r}=e;const[o,c]=(0,s.useState)("text"),[u,m]=(0,s.useState)(!1),[g,v]=(0,s.useState)(null),_=[{value:"text",label:"\u7eaf\u6587\u672c\u683c\u5f0f",description:"\u9002\u5408\u590d\u5236\u7c98\u8d34\u548c\u7b80\u5355\u5206\u4eab",icon:(0,te.jsx)(We.A,{})},{value:"markdown",label:"Markdown\u683c\u5f0f",description:"\u9002\u5408\u6280\u672f\u6587\u6863\u548cGitHub\u7b49\u5e73\u53f0",icon:(0,te.jsx)(Ee.A,{})}],C=async()=>{if(g)try{await navigator.clipboard.writeText(g.content),O.Ay.success("\u5185\u5bb9\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f")}catch(e){O.Ay.error("\u590d\u5236\u5931\u8d25")}};return(0,te.jsxs)(p.A,{open:!0,onClose:r,maxWidth:"md",fullWidth:!0,children:[(0,te.jsx)(f.A,{children:"\u5bfc\u51fa\u4f1a\u8bae\u5b8c\u6574\u8bb0\u5f55"}),(0,te.jsx)(y.A,{children:g?(0,te.jsxs)(x.A,{children:[(0,te.jsxs)(j.A,{severity:"success",sx:{mb:3},children:["\u4f1a\u8bae\u8bb0\u5f55\u5bfc\u51fa\u6210\u529f\uff01\u5305\u542b ",g.meeting_info.statement_count," \u6761\u53d1\u8a00\u8bb0\u5f55"]}),(0,te.jsxs)(a.A,{sx:{p:2,mb:3,backgroundColor:"#ffffff",border:"1px solid #e0e0e0"},children:[(0,te.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{color:"#1976d2",fontWeight:"bold"},children:"\u5bfc\u51fa\u7edf\u8ba1\u4fe1\u606f"}),(0,te.jsxs)(A.Ay,{container:!0,spacing:2,children:[(0,te.jsxs)(A.Ay,{item:!0,xs:3,children:[(0,te.jsx)(l.A,{variant:"caption",sx:{color:"#666"},children:"\u53d1\u8a00\u6570"}),(0,te.jsx)(l.A,{variant:"h6",sx:{color:"#333"},children:g.meeting_info.statement_count})]}),(0,te.jsxs)(A.Ay,{item:!0,xs:3,children:[(0,te.jsx)(l.A,{variant:"caption",sx:{color:"#666"},children:"\u8463\u4e8b\u6570"}),(0,te.jsx)(l.A,{variant:"h6",sx:{color:"#333"},children:g.meeting_info.participant_count})]}),(0,te.jsxs)(A.Ay,{item:!0,xs:3,children:[(0,te.jsx)(l.A,{variant:"caption",sx:{color:"#666"},children:"\u63d0\u95ee\u6570"}),(0,te.jsx)(l.A,{variant:"h6",sx:{color:"#333"},children:g.meeting_info.question_count})]}),(0,te.jsxs)(A.Ay,{item:!0,xs:3,children:[(0,te.jsx)(l.A,{variant:"caption",sx:{color:"#666"},children:"\u683c\u5f0f"}),(0,te.jsx)(l.A,{variant:"h6",sx:{color:"#333"},children:o.toUpperCase()})]})]})]}),(0,te.jsx)(l.A,{variant:"body2",sx:{mb:2,color:"#555",fontWeight:500},children:"\u5185\u5bb9\u9884\u89c8\uff08\u524d200\u5b57\u7b26\uff09\uff1a"}),(0,te.jsx)(a.A,{sx:{p:2,backgroundColor:"#f8f9fa",border:"1px solid #e0e0e0",mb:3},children:(0,te.jsxs)(l.A,{variant:"body2",sx:{fontFamily:"monospace",whiteSpace:"pre-wrap",fontSize:"0.85em",overflow:"hidden",textOverflow:"ellipsis",color:"#333",lineHeight:1.5},children:[g.content.substring(0,200),"..."]})})]}):(0,te.jsxs)(x.A,{children:[(0,te.jsx)(j.A,{severity:"info",sx:{mb:3},children:"\u5c06\u5bfc\u51fa\u5b8c\u6574\u7684\u4f1a\u8bae\u8ba8\u8bba\u8bb0\u5f55\uff0c\u5305\u62ec\u6240\u6709\u8463\u4e8b\u53d1\u8a00\u548c\u7528\u6237\u63d0\u95ee\u73af\u8282"}),(0,te.jsxs)(x.A,{sx:{mb:3},children:[(0,te.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u4f1a\u8bae\u4fe1\u606f"}),(0,te.jsxs)(x.A,{sx:{display:"flex",gap:1,mb:2},children:[(0,te.jsx)(h.A,{label:"".concat(i," \u6761\u53d1\u8a00"),size:"small"}),(0,te.jsx)(h.A,{label:n,size:"small",variant:"outlined"})]})]}),(0,te.jsxs)(J.A,{component:"fieldset",sx:{mb:3},children:[(0,te.jsx)(Se.A,{component:"legend",children:"\u9009\u62e9\u5bfc\u51fa\u683c\u5f0f"}),(0,te.jsx)(ze.A,{value:o,onChange:e=>c(e.target.value),children:_.map(e=>(0,te.jsx)(a.A,{sx:{p:2,mb:1},children:(0,te.jsx)(Ie.A,{value:e.value,control:(0,te.jsx)(Fe.A,{}),label:(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center"},children:[e.icon,(0,te.jsxs)(x.A,{sx:{ml:2},children:[(0,te.jsx)(l.A,{variant:"subtitle2",children:e.label}),(0,te.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e.description})]})]})})},e.value))})]}),u&&(0,te.jsxs)(x.A,{sx:{textAlign:"center",py:2},children:[(0,te.jsx)(V.A,{}),(0,te.jsx)(l.A,{variant:"body2",sx:{mt:1},children:"\u6b63\u5728\u751f\u6210\u5bfc\u51fa\u5185\u5bb9..."})]})]})}),(0,te.jsx)(b.A,{children:g?(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(d.A,{onClick:C,startIcon:(0,te.jsx)(he.A,{}),children:"\u590d\u5236\u5185\u5bb9"}),(0,te.jsx)(d.A,{onClick:async()=>{if(!g)return;const e="\u3010".concat(n,"\u3011\u4f1a\u8bae\u5b8c\u6574\u8bb0\u5f55\n\n\u5305\u542b").concat(g.meeting_info.statement_count,"\u6761\u53d1\u8a00\uff0c").concat(g.meeting_info.participant_count,"\u4f4d\u8463\u4e8b\u53c2\u4e0e\n\n\u6765\u81ea\u79c1\u4eba\u8463\u4e8b\u4f1a\u7cfb\u7edf");if(navigator.share)try{await navigator.share({title:"".concat(n," - \u4f1a\u8bae\u8bb0\u5f55"),text:e,url:window.location.origin})}catch(t){}else await C()},startIcon:(0,te.jsx)(he.A,{}),children:"\u5206\u4eab"}),(0,te.jsx)(d.A,{onClick:async()=>{if(g)try{const e=new Blob([g.content],{type:"markdown"===o?"text/markdown":"text/plain"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="".concat(n,"-\u4f1a\u8bae\u8bb0\u5f55.").concat("markdown"===o?"md":"txt"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t),O.Ay.success("\u6587\u4ef6\u4e0b\u8f7d\u6210\u529f\uff01")}catch(e){console.error("\u4e0b\u8f7d\u5931\u8d25:",e),O.Ay.error("\u4e0b\u8f7d\u5931\u8d25")}},variant:"contained",startIcon:(0,te.jsx)(I.A,{}),children:"\u4e0b\u8f7d\u6587\u4ef6"}),(0,te.jsx)(d.A,{onClick:r,children:"\u5173\u95ed"})]}):(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(d.A,{onClick:r,children:"\u53d6\u6d88"}),(0,te.jsx)(d.A,{onClick:async()=>{m(!0);try{const e=await fetch("https://dongshihui-api.jieshu2023.workers.dev/meetings/".concat(t,"/export"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({export_type:o,include_analysis:!0})}),n=await e.json();n.success?(v(n.data),O.Ay.success("\u4f1a\u8bae\u5185\u5bb9\u5bfc\u51fa\u6210\u529f\uff01")):O.Ay.error(n.error||"\u5bfc\u51fa\u5931\u8d25")}catch(e){console.error("\u5bfc\u51fa\u5931\u8d25:",e),O.Ay.error("\u5bfc\u51fa\u5931\u8d25")}finally{m(!1)}},variant:"contained",disabled:u,startIcon:u?(0,te.jsx)(V.A,{size:16}):(0,te.jsx)(I.A,{}),children:u?"\u5bfc\u51fa\u4e2d...":"\u5f00\u59cb\u5bfc\u51fa"})]})})]})};var Be=n(8),Te=n(4447),Re=n(2974),De=n(7972),Me=n(5127),Le=n(5163);const qe=e=>{let{meeting:t,participants:n,statements:s,currentSpeakerIndex:i,nextSpeakerIndex:r}=e;const o=(null===t||void 0===t?void 0:t.discussion_mode)||"round_robin",d={round_robin:{name:"\u8f6e\u6d41\u53d1\u8a00",icon:(0,te.jsx)(Re.A,{}),color:"#1565C0",bgColor:"#E3F2FD",description:"\u4e25\u683c\u6309\u987a\u5e8f\u8f6e\u6d41\u53d1\u8a00"},debate:{name:"\u8fa9\u8bba\u6a21\u5f0f",icon:(0,te.jsx)(De.A,{}),color:"#D32F2F",bgColor:"#FFEBEE",description:"\u6b63\u53cd\u65b9\u5bf9\u6297\u8fa9\u8bba"},focus:{name:"\u805a\u7126\u8ba8\u8bba",icon:(0,te.jsx)(Me.A,{}),color:"#7B1FA2",bgColor:"#F3E5F5",description:"\u56f4\u7ed5\u6838\u5fc3\u8bae\u9898\u6df1\u5165"},free:{name:"\u81ea\u7531\u53d1\u8a00",icon:(0,te.jsx)(Le.A,{}),color:"#388E3C",bgColor:"#E8F5E8",description:"\u7075\u6d3b\u4e92\u52a8\u968f\u673a\u53d1\u8a00"}}[o];return(()=>{switch(o){case"round_robin":return(()=>{var e,o;return(0,te.jsxs)(a.A,{sx:{p:2,mb:2,backgroundColor:d.bgColor,border:"1px solid ".concat(d.color)},children:[(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[d.icon,(0,te.jsx)(l.A,{variant:"h6",sx:{ml:1,color:d.color,fontWeight:600},children:d.name}),(0,te.jsx)(h.A,{label:d.description,size:"small",sx:{ml:2,backgroundColor:d.color,color:"white"}})]}),(0,te.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"\u53d1\u8a00\u987a\u5e8f\uff1a"}),(0,te.jsx)(x.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:n.map((e,n)=>{var o,a;const l=n===i,c=n===r,x=s.some(n=>n.director_id===e.director_id&&n.round_number===t.current_round);return(0,te.jsx)(h.A,{avatar:(0,te.jsx)(m.A,{src:null===(o=e.director)||void 0===o?void 0:o.avatar_url,sx:{width:24,height:24},children:(0,te.jsx)(E.A,{sx:{fontSize:14}})}),label:"".concat(n+1,". ").concat(null===(a=e.director)||void 0===a?void 0:a.name),variant:l?"filled":"outlined",color:l?"primary":c?"secondary":"default",sx:{backgroundColor:l?d.color:c?"#FFA726":void 0,opacity:x?.6:1,border:c?"2px solid #FFA726":void 0}},e.director_id)})}),-1!==r&&(0,te.jsxs)(l.A,{variant:"body2",sx:{mt:1,color:d.color,fontWeight:500},children:["\u4e0b\u4e00\u4f4d\u53d1\u8a00\uff1a",null===(e=n[r])||void 0===e||null===(o=e.director)||void 0===o?void 0:o.name]})]})})();case"debate":return(()=>{const e=n.filter((e,t)=>t%2===0),t=n.filter((e,t)=>t%2===1);return(0,te.jsxs)(a.A,{sx:{p:2,mb:2,backgroundColor:d.bgColor,border:"1px solid ".concat(d.color)},children:[(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[d.icon,(0,te.jsx)(l.A,{variant:"h6",sx:{ml:1,color:d.color,fontWeight:600},children:d.name}),(0,te.jsx)(h.A,{label:d.description,size:"small",sx:{ml:2,backgroundColor:d.color,color:"white"}})]}),(0,te.jsxs)(A.Ay,{container:!0,spacing:2,children:[(0,te.jsx)(A.Ay,{item:!0,xs:6,children:(0,te.jsxs)(x.A,{sx:{textAlign:"center",p:1,backgroundColor:"#E8F5E8",borderRadius:1},children:[(0,te.jsx)(l.A,{variant:"subtitle2",color:"#2E7D32",fontWeight:"bold",children:"\u6b63\u65b9"}),e.map(e=>{var t,n;return(0,te.jsx)(h.A,{avatar:(0,te.jsx)(m.A,{src:null===(t=e.director)||void 0===t?void 0:t.avatar_url,sx:{width:20,height:20}}),label:null===(n=e.director)||void 0===n?void 0:n.name,size:"small",sx:{m:.5,backgroundColor:"#C8E6C9"}},e.director_id)})]})}),(0,te.jsx)(A.Ay,{item:!0,xs:6,children:(0,te.jsxs)(x.A,{sx:{textAlign:"center",p:1,backgroundColor:"#FFEBEE",borderRadius:1},children:[(0,te.jsx)(l.A,{variant:"subtitle2",color:"#C62828",fontWeight:"bold",children:"\u53cd\u65b9"}),t.map(e=>{var t,n;return(0,te.jsx)(h.A,{avatar:(0,te.jsx)(m.A,{src:null===(t=e.director)||void 0===t?void 0:t.avatar_url,sx:{width:20,height:20}}),label:null===(n=e.director)||void 0===n?void 0:n.name,size:"small",sx:{m:.5,backgroundColor:"#FFCDD2"}},e.director_id)})]})})]})]})})();case"focus":return(()=>{const e=Math.min(s.length/(n.length*t.max_rounds)*100,100);return(0,te.jsxs)(a.A,{sx:{p:2,mb:2,backgroundColor:d.bgColor,border:"1px solid ".concat(d.color)},children:[(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[d.icon,(0,te.jsx)(l.A,{variant:"h6",sx:{ml:1,color:d.color,fontWeight:600},children:d.name}),(0,te.jsx)(h.A,{label:d.description,size:"small",sx:{ml:2,backgroundColor:d.color,color:"white"}})]}),(0,te.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"\u8ba8\u8bba\u6df1\u5ea6\u8fdb\u5c55\uff1a"}),(0,te.jsx)(c.A,{variant:"determinate",value:e,sx:{mb:1,height:8,borderRadius:4,backgroundColor:"#F3E5F5","& .MuiLinearProgress-bar":{backgroundColor:d.color}}}),(0,te.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[Math.round(e),"% - \u7b2c ",t.current_round," \u5c42\u8ba8\u8bba"]}),(0,te.jsx)(x.A,{sx:{mt:2},children:(0,te.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["\ud83c\udfaf \u6838\u5fc3\u8bae\u9898\uff1a",t.topic.split("\uff1f")[0],"\uff1f"]})})]})})();case"free":return(()=>{const e=n.map(e=>(0,Be.A)((0,Be.A)({},e),{},{statementCount:s.filter(t=>t.director_id===e.director_id).length})).sort((e,t)=>t.statementCount-e.statementCount);return(0,te.jsxs)(a.A,{sx:{p:2,mb:2,backgroundColor:d.bgColor,border:"1px solid ".concat(d.color)},children:[(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[d.icon,(0,te.jsx)(l.A,{variant:"h6",sx:{ml:1,color:d.color,fontWeight:600},children:d.name}),(0,te.jsx)(h.A,{label:d.description,size:"small",sx:{ml:2,backgroundColor:d.color,color:"white"}})]}),(0,te.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"\u53d1\u8a00\u6d3b\u8dc3\u5ea6\uff1a"}),e.map((e,t)=>{var n,s;return(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,te.jsx)(Te.A,{badgeContent:t+1,color:0===t?"primary":"default",sx:{mr:1},children:(0,te.jsx)(m.A,{src:null===(n=e.director)||void 0===n?void 0:n.avatar_url,sx:{width:32,height:32},children:(0,te.jsx)(E.A,{sx:{fontSize:16}})})}),(0,te.jsxs)(x.A,{sx:{flex:1,ml:1},children:[(0,te.jsx)(l.A,{variant:"body2",fontWeight:0===t?600:400,children:null===(s=e.director)||void 0===s?void 0:s.name}),(0,te.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[e.statementCount," \u6b21\u53d1\u8a00"]})]}),(0,te.jsx)(h.A,{label:e.statementCount,size:"small",color:0===t?"success":"default"})]},e.director_id)})]})})();default:return null}})()};var Oe=n(8089),Pe=n(704),Ue=n(5931);const Qe=e=>{var t;let{statement:n,index:s,statements:o,meeting:c,onShareQuote:A,onRebuttal:g}=e;const j=n.Director,p="user_question"===n.content_type,f="question_response"===n.content_type,y=(null===c||void 0===c?void 0:c.discussion_mode)||"round_robin",b=(0,i.A)(),v=(0,r.A)(b.breakpoints.down("md")),_=(0===s||(n.round_number,null===(t=o[s-1])||void 0===t||t.round_number),n.sequence_in_round%2===1),C=(()=>{if(p)return{bg:"#E3F2FD",border:"2px solid #1565C0"};if(f)return{bg:"#FFF8E1",border:"2px solid #FFA000",borderLeft:"6px solid #FFA000"};switch(y){case"debate":return{bg:_?"#E8F5E8":"#FFEBEE",border:_?"2px solid #2E7D32":"2px solid #C62828",alignSelf:_?"flex-start":"flex-end",maxWidth:"85%"};case"focus":return{bg:"#F3E5F5",border:"2px solid #7B1FA2",borderLeft:"6px solid #7B1FA2"};case"free":return{bg:"#E8F5E8",border:"1px solid #4CAF50",borderRadius:"16px"};default:return{bg:"#FAFAFA",border:"1px solid #E0E0E0"}}})();return(0,te.jsx)(x.A,{sx:{display:"flex",flexDirection:"debate"===y?"column":"row",alignItems:"debate"===y?C.alignSelf:"stretch",width:"debate"===y?C.maxWidth:"100%",mb:2},children:(0,te.jsx)(Oe.A,{sx:{flex:1,backgroundColor:C.bg,border:C.border,borderLeft:C.borderLeft,borderRadius:C.borderRadius||"8px",transition:"all 0.2s ease","&:hover":{boxShadow:"0 6px 20px rgba(0,0,0,0.1)",transform:"translateY(-1px)"}},children:(0,te.jsxs)(Pe.A,{sx:{p:v?2:3},children:[(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,te.jsx)(m.A,{src:null===j||void 0===j?void 0:j.avatar_url,sx:{width:v?36:40,height:v?36:40,mr:v?1.5:2,backgroundColor:(()=>{if(p)return"#1565C0";if(f)return"#FFA000";switch(y){case"debate":return _?"#2E7D32":"#C62828";case"focus":return"#7B1FA2";case"free":return"#388E3C";default:return"#F57C00"}})(),border:"3px solid #fff",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:p?(0,te.jsx)(K.A,{}):(0,te.jsx)(E.A,{})}),(0,te.jsxs)(x.A,{sx:{flex:1},children:[(0,te.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:600,color:p?"#1565C0":f?"#FFA000":"#333",fontSize:v?"1rem":"1.1rem"},children:(()=>{if(p)return"\u7528\u6237\u63d0\u95ee";if(f)return"".concat(null===j||void 0===j?void 0:j.name," (\u56de\u590d\u63d0\u95ee)");switch(y){case"debate":return"".concat(null===j||void 0===j?void 0:j.name," (").concat(_?"\u6b63\u65b9":"\u53cd\u65b9",")");case"focus":return"".concat(null===j||void 0===j?void 0:j.name," (\u7b2c").concat(n.round_number,"\u5c42)");case"free":return"".concat(null===j||void 0===j?void 0:j.name," (").concat(n.sequence_in_round,")");default:return null===j||void 0===j?void 0:j.name}})()}),(0,te.jsxs)(l.A,{variant:"body2",sx:{color:"#666",fontWeight:500,fontSize:v?"0.85rem":"0.9rem"},children:[p?"\u4f1a\u8bae\u53c2\u4e0e\u8005":null===j||void 0===j?void 0:j.title,n.created_at&&(0,te.jsxs)(l.A,{component:"span",sx:{ml:1,color:"#888",fontWeight:600,fontSize:"0.85rem"},children:["\xb7 ",(0,L.A)(new Date(n.created_at),"HH:mm",{locale:q.A})]})]})]}),"debate"===y&&!p&&(0,te.jsx)(h.A,{label:_?"\u6b63\u65b9":"\u53cd\u65b9",size:"small",color:_?"success":"error",sx:{mr:1}}),"focus"===y&&!p&&(0,te.jsx)(h.A,{label:"\u7b2c".concat(n.round_number,"\u5c42"),size:"small",color:"secondary",sx:{mr:1}}),"opening"===n.content_type&&(0,te.jsx)(h.A,{label:"\u5f00\u573a",size:"small",color:"success"}),"closing"===n.content_type&&(0,te.jsx)(h.A,{label:"\u7ed3\u8bed",size:"small",color:"error"}),"user_question"===n.content_type&&(0,te.jsx)(h.A,{label:"\u7528\u6237\u63d0\u95ee",size:"small",color:"info"}),"question_response"===n.content_type&&(0,te.jsx)(h.A,{label:"\u56de\u590d\u63d0\u95ee",size:"small",color:"warning"}),!p&&(0,te.jsxs)(x.A,{sx:{display:"flex",gap:.5,flexDirection:v?"column":"row",alignItems:v?"flex-end":"center"},children:[(0,te.jsx)(ce,{statementId:f?null:n.id,responseId:f?n.id:null,favoriteType:f?"response":"statement"}),(0,te.jsx)(u.A,{size:v?"medium":"small",onClick:()=>A(n.id),title:"\u751f\u6210\u91d1\u53e5\u5361\u7247",sx:{minHeight:v?44:"auto"},children:(0,te.jsx)(he.A,{})}),"debate"===y&&g&&(0,te.jsx)(d.A,{size:v?"medium":"small",startIcon:(0,te.jsx)(Ue.A,{}),onClick:()=>g(n),variant:"outlined",color:_?"error":"success",sx:{ml:v?0:1,mt:v?.5:0,minHeight:v?44:"auto"},children:"\u53cd\u9a73"})]})]}),(0,te.jsx)(l.A,{variant:"body1",sx:{whiteSpace:"pre-wrap",fontSize:v?p?"0.95rem":"1rem":p?"1rem":"1.1rem",lineHeight:v?1.6:1.7,color:p?"#1565C0":f?"#E65100":"#333",fontWeight:p||f?500:400,letterSpacing:"0.02em",mt:1},children:n.content}),"debate"===y&&n.response_to&&(0,te.jsx)(a.A,{sx:{mt:2,p:1,backgroundColor:"#FFF3E0",border:"1px solid #FF9800"},children:(0,te.jsx)(l.A,{variant:"caption",color:"#F57C00",fontWeight:"bold",children:"\ud83d\udd25 \u53cd\u9a73\u4e86\u4e0a\u4e00\u4f4d\u53d1\u8a00"})})]})})})},Ne=()=>{var e,t,n;const U=(0,D.Zp)(),{id:Q}=(0,D.g)(),N=((0,M.useQueryClient)(),(0,s.useRef)(null)),J=(0,s.useRef)(null),Y=(0,i.A)(),G=(0,r.A)(Y.breakpoints.down("md")),[Z,V]=((0,r.A)(Y.breakpoints.between("sm","md")),(0,s.useState)(!1)),[K,X]=(0,s.useState)(!1),[$,ee]=(0,s.useState)([]),[se,ie]=(0,s.useState)(!1),[re,oe]=(0,s.useState)(null),[ae,le]=(0,s.useState)(!1),[ce,xe]=(0,s.useState)(!1),[he,me]=(0,s.useState)(null),[Ae,ge]=(0,s.useState)(!1),[je,pe]=(0,s.useState)(!0),[fe,ye]=(0,s.useState)(0),{data:be,isLoading:ve,error:_e,refetch:Ce}=(0,M.useQuery)(["meeting",Q],()=>P.ej.getById(Q),{enabled:!!Q,refetchInterval:e=>{var t;const n=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data;return!(!n||!["discussing","debating"].includes(n.status))&&3e3},onError:e=>{O.Ay.error("\u83b7\u53d6\u4f1a\u8bae\u8be6\u60c5\u5931\u8d25: "+e.message),U("/hall")}}),we=null===be||void 0===be||null===(e=be.data)||void 0===e?void 0:e.data,Se=(null===we||void 0===we?void 0:we.statements)||[],ze=(null===we||void 0===we?void 0:we.participants)||[],Ie=(0,M.useMutation)(()=>P.ej.start(Q),{onSuccess:()=>{O.Ay.success("\u4f1a\u8bae\u5df2\u5f00\u59cb\uff01"),Ce(),setTimeout(()=>{Z||Te()},1e3)},onError:e=>{O.Ay.error("\u5f00\u59cb\u4f1a\u8bae\u5931\u8d25: "+e.message)}}),Fe=(0,M.useMutation)(()=>P.ej.pause(Q),{onSuccess:()=>{O.Ay.success("\u4f1a\u8bae\u5df2\u6682\u505c"),Ce()},onError:e=>{O.Ay.error("\u6682\u505c\u4f1a\u8bae\u5931\u8d25: "+e.message)}}),We=(0,M.useMutation)(()=>P.ej.resume(Q),{onSuccess:()=>{O.Ay.success("\u4f1a\u8bae\u5df2\u6062\u590d"),Ce()},onError:e=>{O.Ay.error("\u6062\u590d\u4f1a\u8bae\u5931\u8d25: "+e.message)}}),Ee=(0,M.useMutation)(()=>P.ej.finish(Q),{onSuccess:()=>{O.Ay.success("\u4f1a\u8bae\u5df2\u7ed3\u675f"),X(!1),Ce()},onError:e=>{O.Ay.error("\u7ed3\u675f\u4f1a\u8bae\u5931\u8d25: "+e.message)}}),Be=(0,M.useMutation)(()=>P.ej.generateNextStatement(Q),{onSuccess:e=>{var t,n,s;const i=null===(t=e.data)||void 0===t||null===(n=t.data)||void 0===n||null===(s=n.director)||void 0===s?void 0:s.name;O.Ay.success("".concat(i," \u7684\u53d1\u8a00\u5df2\u751f\u6210").concat(je?"":"\uff0c\u6eda\u52a8\u67e5\u770b\u6700\u65b0\u5185\u5bb9")),Ce(),V(!1)},onError:e=>{O.Ay.error("\u751f\u6210\u53d1\u8a00\u5931\u8d25: "+e.message),V(!1)}}),Te=()=>{Z||(V(!0),Be.mutate())},Re=async()=>{if(Q)try{const e=await fetch("https://dongshihui-api.jieshu2023.workers.dev/meetings/".concat(Q,"/questions")),t=await e.json();t.success&&ee(t.data)}catch(_e){console.error("\u83b7\u53d6\u95ee\u9898\u5217\u8868\u5931\u8d25:",_e)}};(0,s.useEffect)(()=>{Q&&we&&Re()},[Q,we]);const De=e=>{oe(e),ie(!0)},Me=e=>{me(e),"debate"===we.discussion_mode&&Te()},Le=()=>{if("round_robin"!==(null===we||void 0===we?void 0:we.discussion_mode))return-1;return Se.filter(e=>e.round_number===we.current_round&&"regular"===e.content_type).length%ze.length},Oe=()=>{if("round_robin"!==(null===we||void 0===we?void 0:we.discussion_mode))return-1;return(Le()+1)%ze.length};(0,s.useEffect)(()=>{const e=Se.length;e>fe&&je&&J.current&&(setTimeout(()=>{const e=J.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},100),ye(e))},[Se,je,fe]);const Pe={preparing:{label:"\u51c6\u5907\u4e2d",color:"default"},discussing:{label:"\u8ba8\u8bba\u4e2d",color:"success"},debating:{label:"\u8fa9\u8bba\u4e2d",color:"warning"},paused:{label:"\u5df2\u6682\u505c",color:"info"},finished:{label:"\u5df2\u7ed3\u675f",color:"error"}}[Ue=null===we||void 0===we?void 0:we.status]||{label:Ue,color:"default"};var Ue;return ve?(0,te.jsx)(o.A,{maxWidth:"lg",sx:{py:4},children:(0,te.jsxs)(a.A,{sx:{p:4,textAlign:"center"},children:[(0,te.jsx)(l.A,{variant:"h6",children:"\u52a0\u8f7d\u4f1a\u8bae\u4fe1\u606f\u4e2d..."}),(0,te.jsx)(c.A,{sx:{mt:2}})]})}):_e||!we?(0,te.jsx)(o.A,{maxWidth:"lg",sx:{py:4},children:(0,te.jsxs)(a.A,{sx:{p:4,textAlign:"center"},children:[(0,te.jsx)(l.A,{variant:"h6",color:"error",gutterBottom:!0,children:"\u52a0\u8f7d\u4f1a\u8bae\u5931\u8d25"}),(0,te.jsx)(d.A,{variant:"contained",onClick:()=>U("/hall"),children:"\u8fd4\u56de\u5927\u5385"})]})}):(0,te.jsxs)(o.A,{maxWidth:"lg",sx:{py:G?1:2},children:[(0,te.jsxs)(a.A,{sx:{p:G?2:3,mb:G?2:3},children:[(0,te.jsxs)(x.A,{sx:{display:"flex",flexDirection:G?"column":"row",justifyContent:"space-between",alignItems:G?"stretch":"center",gap:G?2:0,mb:2},children:[(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center"},children:[(0,te.jsx)(d.A,{startIcon:(0,te.jsx)(C.A,{}),onClick:()=>U("/hall"),sx:{mr:2},size:"medium",children:"\u8fd4\u56de\u5927\u5385"}),(0,te.jsxs)(x.A,{children:[(0,te.jsx)(l.A,{variant:"h5",component:"h1",children:we.title}),(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[(0,te.jsx)(h.A,{label:Pe.label,color:Pe.color,size:"small"}),(0,te.jsx)(h.A,{label:"round_robin"===we.discussion_mode?"\u8f6e\u6d41\u53d1\u8a00":"debate"===we.discussion_mode?"\u8fa9\u8bba\u6a21\u5f0f":"focus"===we.discussion_mode?"\u805a\u7126\u8ba8\u8bba":"free"===we.discussion_mode?"\u81ea\u7531\u53d1\u8a00":"\u672a\u77e5\u6a21\u5f0f",variant:"outlined",size:"small",sx:{color:"debate"===we.discussion_mode?"#D32F2F":"focus"===we.discussion_mode?"#7B1FA2":"free"===we.discussion_mode?"#388E3C":"#1565C0",borderColor:"debate"===we.discussion_mode?"#D32F2F":"focus"===we.discussion_mode?"#7B1FA2":"free"===we.discussion_mode?"#388E3C":"#1565C0"}}),(0,te.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[("debate"===we.discussion_mode||we.discussion_mode,"\u7b2c")," ",we.current_round,"/",we.max_rounds," ","debate"===we.discussion_mode?"\u56de\u5408":"focus"===we.discussion_mode?"\u5c42":"\u8f6e"]}),(0,te.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[Se.length," \u6761\u53d1\u8a00"]})]})]})]}),(0,te.jsxs)(x.A,{"data-meeting-controls":!0,sx:{display:"flex",gap:1,flexWrap:G?"wrap":"nowrap",justifyContent:G?"center":"flex-end"},children:["preparing"===we.status&&(0,te.jsx)(d.A,{variant:"contained",startIcon:(0,te.jsx)(w.A,{}),onClick:()=>Ie.mutate(),disabled:Ie.isLoading,color:"success",size:G?"large":"medium",sx:{minHeight:G?48:"auto"},children:"\u5f00\u59cb\u4f1a\u8bae"}),["discussing","debating"].includes(we.status)&&(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(d.A,{variant:"outlined",startIcon:(0,te.jsx)(k.A,{}),onClick:()=>Fe.mutate(),disabled:Fe.isLoading,size:G?"large":"medium",sx:{minHeight:G?48:"auto"},children:"\u6682\u505c"}),(0,te.jsx)(d.A,{variant:"contained",startIcon:(0,te.jsx)(S.A,{}),onClick:Te,disabled:Z,color:"primary",size:G?"large":"medium",sx:{minHeight:G?48:"auto"},children:Z?"\u751f\u6210\u4e2d...":"debate"===we.discussion_mode?"\u7ee7\u7eed\u8fa9\u8bba":"focus"===we.discussion_mode?"\u6df1\u5165\u8ba8\u8bba":"free"===we.discussion_mode?"\u81ea\u7531\u53d1\u8a00":"\u4e0b\u4e00\u4e2a\u53d1\u8a00"})]}),"paused"===we.status&&(0,te.jsx)(d.A,{variant:"contained",startIcon:(0,te.jsx)(w.A,{}),onClick:()=>We.mutate(),disabled:We.isLoading,color:"success",size:G?"large":"medium",sx:{minHeight:G?48:"auto"},children:"\u7ee7\u7eed\u4f1a\u8bae"}),!G&&Se.length>0&&(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(d.A,{variant:"outlined",startIcon:(0,te.jsx)(z.A,{}),onClick:()=>le(!0),color:"info",children:"\u751f\u6210\u6458\u8981"}),(0,te.jsx)(d.A,{variant:"outlined",startIcon:(0,te.jsx)(I.A,{}),onClick:()=>xe(!0),color:"secondary",children:"\u5bfc\u51fa\u5168\u6587"})]}),G&&Se.length>0&&(0,te.jsx)(u.A,{onClick:()=>ge(!0),size:"large",sx:{backgroundColor:"primary.main",color:"white","&:hover":{backgroundColor:"primary.dark"}},children:(0,te.jsx)(F.A,{})}),!["finished"].includes(we.status)&&(0,te.jsx)(d.A,{variant:"outlined",startIcon:(0,te.jsx)(W.A,{}),onClick:()=>X(!0),color:"error",size:G?"large":"medium",sx:{minHeight:G?48:"auto"},children:"\u7ed3\u675f\u4f1a\u8bae"})]})]}),(0,te.jsxs)(x.A,{sx:{bgcolor:"background.default",p:2,borderRadius:1,mb:2},children:[(0,te.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"\u8ba8\u8bba\u8bdd\u9898\uff1a"}),(0,te.jsx)(l.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:we.topic})]}),(0,te.jsx)(x.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:ze.map(e=>{var t,n;return(0,te.jsx)(h.A,{avatar:(0,te.jsx)(m.A,{src:null===(t=e.director)||void 0===t?void 0:t.avatar_url,sx:{width:24,height:24},children:(0,te.jsx)(E.A,{sx:{fontSize:14}})}),label:"".concat(null===(n=e.director)||void 0===n?void 0:n.name," (").concat(e.statement_count||0,")"),variant:"outlined",size:"small"},e.id)})})]}),(0,te.jsxs)(A.Ay,{container:!0,spacing:G?2:3,children:[(0,te.jsx)(A.Ay,{item:!0,xs:12,md:8,order:G?2:1,children:(0,te.jsxs)(a.A,{sx:{height:G?"50vh":"60vh",display:"flex",flexDirection:"column"},children:[(0,te.jsxs)(x.A,{sx:{p:G?1.5:2,borderBottom:1,borderColor:"divider",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,te.jsx)(l.A,{variant:G?"subtitle1":"h6",children:"\u4f1a\u8bae\u8ba8\u8bba\u8bb0\u5f55"}),(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,te.jsx)(u.A,{size:"small",onClick:()=>pe(!je),title:je?"\u5173\u95ed\u81ea\u52a8\u6eda\u52a8":"\u5f00\u542f\u81ea\u52a8\u6eda\u52a8",sx:{color:je?"primary.main":"text.secondary",backgroundColor:je?"primary.light":"transparent"},children:(0,te.jsx)(H.A,{sx:{fontSize:18}})}),(0,te.jsx)(u.A,{size:"small",onClick:()=>{const e=J.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},title:"\u6eda\u52a8\u5230\u6700\u65b0\u53d1\u8a00",children:(0,te.jsx)(B.A,{sx:{fontSize:18}})}),G&&(0,te.jsx)(h.A,{label:"".concat(we.current_round,"/").concat(we.max_rounds,"\u8f6e"),size:"small",color:"primary"})]})]}),(0,te.jsxs)(x.A,{ref:J,sx:{flex:1,overflow:"auto",p:G?1.5:2},children:[0===Se.length?(0,te.jsxs)(x.A,{sx:{textAlign:"center",py:6},children:[(0,te.jsx)(T.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,te.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"preparing"===we.status?'\u4f1a\u8bae\u5c1a\u672a\u5f00\u59cb\uff0c\u70b9\u51fb"\u5f00\u59cb\u4f1a\u8bae"\u5f00\u59cb\u8ba8\u8bba':"\u6682\u65e0\u53d1\u8a00\u8bb0\u5f55"})]}):(0,te.jsx)(te.Fragment,{children:Se.map((e,t)=>{var n;const i=0===t||e.round_number!==(null===(n=Se[t-1])||void 0===n?void 0:n.round_number);return(0,te.jsxs)(s.Fragment,{children:[i&&we.discussion_mode&&(0,te.jsx)(x.A,{sx:{textAlign:"center",my:3},children:(0,te.jsx)(g.A,{children:(0,te.jsx)(h.A,{label:"debate"===we.discussion_mode?"\u7b2c".concat(e.round_number,"\u56de\u5408"):"focus"===we.discussion_mode?"\u7b2c".concat(e.round_number,"\u5c42\u8ba8\u8bba"):"free"===we.discussion_mode?"\u9636\u6bb5".concat(e.round_number):"\u7b2c".concat(e.round_number,"\u8f6e"),size:"small",color:"primary",sx:{backgroundColor:"debate"===we.discussion_mode?"#D32F2F":"focus"===we.discussion_mode?"#7B1FA2":"free"===we.discussion_mode?"#388E3C":"#1565C0",color:"white",fontWeight:600}})})}),(0,te.jsx)(Qe,{statement:e,index:t,statements:Se,meeting:we,onShareQuote:De,onRebuttal:"debate"===we.discussion_mode?Me:null})]},e.id)})}),(0,te.jsx)("div",{ref:N})]})]})}),(0,te.jsxs)(A.Ay,{item:!0,xs:12,md:4,order:G?1:2,children:[!G&&(0,te.jsx)(qe,{meeting:we,participants:ze,statements:Se,currentSpeakerIndex:Le(),nextSpeakerIndex:Oe()}),G&&(0,te.jsx)(a.A,{sx:{p:2,mb:2,backgroundColor:"#E3F2FD"},children:(0,te.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,te.jsx)(l.A,{variant:"subtitle2",color:"primary",fontWeight:"bold",children:"round_robin"===we.discussion_mode?"\u8f6e\u6d41\u53d1\u8a00\u6a21\u5f0f":"debate"===we.discussion_mode?"\u8fa9\u8bba\u6a21\u5f0f":"focus"===we.discussion_mode?"\u805a\u7126\u8ba8\u8bba\u6a21\u5f0f":"free"===we.discussion_mode?"\u81ea\u7531\u53d1\u8a00\u6a21\u5f0f":"\u8ba8\u8bba\u6a21\u5f0f"}),(0,te.jsx)(h.A,{label:"".concat(Se.length,"\u53d1\u8a00"),size:"small",color:"primary"})]})}),["discussing","debating","paused"].includes(we.status)&&(0,te.jsx)(ne,{meetingId:Q,onQuestionSubmitted:e=>{ee(t=>[e,...t]);if("all"===e.question_scope){O.Ay.success("\u63d0\u95ee\u5df2\u63d0\u4ea4\uff0c".concat(ze.length,"\u4f4d\u8463\u4e8b\u6b63\u5728\u4f9d\u6b21\u56de\u5e94..."));let e=0;const t=ze.length+1,n=setInterval(()=>{e++,Ce(),Re(),e>=t&&clearInterval(n)},3500)}else O.Ay.success("\u63d0\u95ee\u5df2\u63d0\u4ea4\uff0c\u6307\u5b9a\u8463\u4e8b\u6b63\u5728\u56de\u5e94..."),setTimeout(()=>{Ce(),Re()},3500)},participants:ze}),$.length>0&&(0,te.jsx)(a.A,{sx:{p:G?1.5:2,mb:G?2:3,maxHeight:G?"30vh":"40vh",overflow:"auto"},children:(0,te.jsx)(de,{questions:$})}),!G&&(0,te.jsxs)(a.A,{sx:{p:3,mb:3},children:[(0,te.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u4f1a\u8bae\u7edf\u8ba1"}),(0,te.jsxs)(x.A,{sx:{space:2},children:[(0,te.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,te.jsx)(l.A,{variant:"body2",children:"\u8fdb\u884c\u8f6e\u6570"}),(0,te.jsxs)(l.A,{variant:"body2",fontWeight:"bold",children:[we.current_round,"/",we.max_rounds]})]}),(0,te.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,te.jsx)(l.A,{variant:"body2",children:"\u603b\u53d1\u8a00\u6570"}),(0,te.jsx)(l.A,{variant:"body2",fontWeight:"bold",children:Se.length})]}),(0,te.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,te.jsx)(l.A,{variant:"body2",children:"\u53c2\u4e0e\u4eba\u6570"}),(0,te.jsx)(l.A,{variant:"body2",fontWeight:"bold",children:ze.length})]}),we.started_at&&(0,te.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,te.jsx)(l.A,{variant:"body2",children:"\u5f00\u59cb\u65f6\u95f4"}),(0,te.jsx)(l.A,{variant:"body2",fontWeight:"bold",children:(0,L.A)(new Date(we.started_at),"HH:mm",{locale:q.A})})]})]})]}),Z&&(0,te.jsxs)(a.A,{sx:{p:G?2:3,mb:G?2:3},children:[(0,te.jsx)(l.A,{variant:G?"subtitle1":"h6",gutterBottom:!0,children:"AI \u751f\u6210\u4e2d..."}),(0,te.jsx)(c.A,{sx:{mb:2}}),(0,te.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"\u6b63\u5728\u8ba9\u8463\u4e8b\u4eec\u601d\u8003\u5e76\u751f\u6210\u56de\u5e94\uff0c\u8bf7\u7a0d\u5019..."})]}),"discussing"===we.status&&!Z&&(0,te.jsxs)(j.A,{severity:"info",sx:{fontSize:G?"0.9rem":"1rem"},children:["round_robin"===we.discussion_mode&&"\u4e0b\u4e00\u4f4d\u53d1\u8a00\uff1a".concat((null===(t=ze[Oe()])||void 0===t||null===(n=t.director)||void 0===n?void 0:n.name)||"\u7b49\u5f85\u786e\u5b9a"),"debate"===we.discussion_mode&&'\u70b9\u51fb"\u7ee7\u7eed\u8fa9\u8bba"\u8ba9\u5bf9\u65b9\u8fdb\u884c\u53cd\u9a73',"focus"===we.discussion_mode&&'\u70b9\u51fb"\u6df1\u5165\u8ba8\u8bba"\u8fdb\u5165\u4e0b\u4e00\u5c42\u5206\u6790',"free"===we.discussion_mode&&'\u70b9\u51fb"\u81ea\u7531\u53d1\u8a00"\u8ba9\u8463\u4e8b\u4eec\u968f\u673a\u4e92\u52a8',!we.discussion_mode&&'\u70b9\u51fb"\u4e0b\u4e00\u4e2a\u53d1\u8a00"\u8ba9\u8463\u4e8b\u4eec\u7ee7\u7eed\u8ba8\u8bba']})]})]}),(0,te.jsxs)(p.A,{open:K,onClose:()=>X(!1),children:[(0,te.jsx)(f.A,{children:"\u786e\u8ba4\u7ed3\u675f\u4f1a\u8bae"}),(0,te.jsx)(y.A,{children:(0,te.jsx)(l.A,{children:"\u786e\u5b9a\u8981\u7ed3\u675f\u8fd9\u6b21\u4f1a\u8bae\u5417\uff1f\u7ed3\u675f\u540e\u5c06\u751f\u6210\u4f1a\u8bae\u6458\u8981\uff0c\u4e14\u65e0\u6cd5\u7ee7\u7eed\u6dfb\u52a0\u53d1\u8a00\u3002"})}),(0,te.jsxs)(b.A,{children:[(0,te.jsx)(d.A,{onClick:()=>X(!1),children:"\u53d6\u6d88"}),(0,te.jsx)(d.A,{color:"error",onClick:()=>Ee.mutate(),disabled:Ee.isLoading,children:Ee.isLoading?"\u7ed3\u675f\u4e2d...":"\u786e\u8ba4\u7ed3\u675f"})]})]}),se&&re&&(0,te.jsx)(ue,{statementId:re,onClose:()=>{ie(!1),oe(null)}}),ae&&(0,te.jsx)(ke,{meetingId:Q,meetingTitle:we.title,onClose:()=>le(!1)}),ce&&(0,te.jsx)(He,{meetingId:Q,meetingTitle:we.title,statementCount:Se.length,onClose:()=>xe(!1)}),(0,te.jsx)(v.A,{anchor:"bottom",open:Ae,onClose:()=>ge(!1),onOpen:()=>ge(!0),disableSwipeToOpen:!1,children:(0,te.jsxs)(x.A,{sx:{p:3},children:[(0,te.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,te.jsx)(l.A,{variant:"h6",children:"\u4f1a\u8bae\u64cd\u4f5c"}),(0,te.jsx)(u.A,{onClick:()=>ge(!1),children:(0,te.jsx)(R.A,{})})]}),(0,te.jsxs)(A.Ay,{container:!0,spacing:2,children:[(0,te.jsx)(A.Ay,{item:!0,xs:6,children:(0,te.jsx)(d.A,{fullWidth:!0,variant:"outlined",startIcon:(0,te.jsx)(z.A,{}),onClick:()=>{le(!0),ge(!1)},color:"info",size:"large",sx:{minHeight:56},children:"\u751f\u6210\u6458\u8981"})}),(0,te.jsx)(A.Ay,{item:!0,xs:6,children:(0,te.jsx)(d.A,{fullWidth:!0,variant:"outlined",startIcon:(0,te.jsx)(I.A,{}),onClick:()=>{xe(!0),ge(!1)},color:"secondary",size:"large",sx:{minHeight:56},children:"\u5bfc\u51fa\u5168\u6587"})})]}),(0,te.jsxs)(a.A,{sx:{p:2,mt:3,backgroundColor:"#F5F5F5"},children:[(0,te.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,fontWeight:"bold",children:"\u4f1a\u8bae\u7edf\u8ba1"}),(0,te.jsxs)(A.Ay,{container:!0,spacing:2,children:[(0,te.jsx)(A.Ay,{item:!0,xs:4,children:(0,te.jsxs)(x.A,{sx:{textAlign:"center"},children:[(0,te.jsx)(l.A,{variant:"h6",color:"primary",children:we.current_round}),(0,te.jsx)(l.A,{variant:"caption",children:"\u5f53\u524d\u8f6e\u6b21"})]})}),(0,te.jsx)(A.Ay,{item:!0,xs:4,children:(0,te.jsxs)(x.A,{sx:{textAlign:"center"},children:[(0,te.jsx)(l.A,{variant:"h6",color:"primary",children:Se.length}),(0,te.jsx)(l.A,{variant:"caption",children:"\u603b\u53d1\u8a00\u6570"})]})}),(0,te.jsx)(A.Ay,{item:!0,xs:4,children:(0,te.jsxs)(x.A,{sx:{textAlign:"center"},children:[(0,te.jsx)(l.A,{variant:"h6",color:"primary",children:ze.length}),(0,te.jsx)(l.A,{variant:"caption",children:"\u53c2\u4e0e\u8463\u4e8b"})]})})]})]})]})}),Se.length>3&&(0,te.jsx)(_.A,{color:"primary",size:"medium",onClick:()=>{const e=document.querySelector("[data-meeting-controls]");null===e||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"})},sx:{position:"fixed",bottom:G?80:24,right:24,zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},title:"\u56de\u5230\u63a7\u5236\u533a\u57df",children:(0,te.jsx)(B.A,{})})]})}},9971:(e,t,n)=>{n.r(t),n.d(t,{default:()=>H});var s=n(8),i=n(9950),r=n(6589),o=n(9808),a=n(6491),l=n(8216),c=n(2053),d=n(899),x=n(2235),h=n(9925),u=n(5979),m=n(9647),A=n(6101),g=n(3266),j=n(3174),p=n(8089),f=n(704),y=n(3038),b=n(1413),v=n(5277),_=n(4745),C=n(4857),w=n(3256),k=n(4801),S=n(294),z=n(8429),I=n(1920),F=n(5887),W=n(9181),E=n(4414);const H=()=>{var e;const t=(0,z.Zp)(),n=(0,I.useQueryClient)(),H=(0,C.A)(),B=(0,r.A)(H.breakpoints.down("md")),[T,R]=(0,i.useState)({title:"",topic:"",discussion_mode:"round_robin",max_rounds:5,max_participants:8,director_ids:[]}),[D,M]=(0,i.useState)([]),[L,q]=(0,i.useState)(null),[O,P]=(0,i.useState)(!1),{data:U,isLoading:Q}=(0,I.useQuery)("activeDirectors",()=>W.hV.getActive(),{onError:e=>{F.Ay.error("\u83b7\u53d6\u8463\u4e8b\u5217\u8868\u5931\u8d25: "+e.message)}}),N=(null===U||void 0===U||null===(e=U.data)||void 0===e?void 0:e.data)||[],{data:J,isLoading:Y}=(0,I.useQuery)("directorGroups",async()=>(await fetch("https://dongshihui-api.jieshu2023.workers.dev/director-groups?user_id=default_user")).json(),{onError:e=>{console.error("\u83b7\u53d6\u8463\u4e8b\u7ec4\u5408\u5931\u8d25:",e)}}),G=(null===J||void 0===J||J.data,(0,I.useMutation)(e=>W.ej.create(e),{onSuccess:e=>{F.Ay.success("\u4f1a\u8bae\u521b\u5efa\u6210\u529f\uff01"),n.invalidateQueries("meetings"),t("/meeting/".concat(e.data.data.id))},onError:e=>{F.Ay.error("\u521b\u5efa\u4f1a\u8bae\u5931\u8d25: "+e.message)}})),Z=(e,t)=>{R(n=>(0,s.A)((0,s.A)({},n),{},{[e]:t}))},V=e=>{if(D.find(t=>t.id===e.id))M(t=>t.filter(t=>t.id!==e.id)),R(t=>(0,s.A)((0,s.A)({},t),{},{director_ids:t.director_ids.filter(t=>t!==e.id)}));else{if(D.length>=T.max_participants)return void F.Ay.error("\u6700\u591a\u53ea\u80fd\u9009\u62e9".concat(T.max_participants,"\u4f4d\u8463\u4e8b"));M(t=>[...t,e]),R(t=>(0,s.A)((0,s.A)({},t),{},{director_ids:[...t.director_ids,e.id]}))}},K={round_robin:"\u8f6e\u6d41\u53d1\u8a00",debate:"\u8fa9\u8bba\u6a21\u5f0f",focus:"\u805a\u7126\u8ba8\u8bba",free:"\u81ea\u7531\u53d1\u8a00"};return(0,E.jsxs)(o.A,{maxWidth:"lg",sx:{py:B?2:4},children:[(0,E.jsxs)(a.A,{sx:{display:"flex",flexDirection:B?"column":"row",alignItems:B?"stretch":"center",gap:B?2:0,mb:B?3:4},children:[(0,E.jsx)(l.A,{startIcon:(0,E.jsx)(k.A,{}),onClick:()=>t("/hall"),sx:{mr:B?0:2,alignSelf:B?"flex-start":"center",width:B?"fit-content":"auto"},size:"medium",children:"\u8fd4\u56de"}),(0,E.jsx)(c.A,{variant:B?"h5":"h4",component:"h1",children:"\u521b\u5efa\u65b0\u4f1a\u8bae"})]}),(0,E.jsxs)("form",{onSubmit:e=>{e.preventDefault(),T.title.trim()&&T.topic.trim()?0!==T.director_ids.length?G.mutate(T):F.Ay.error("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4f4d\u8463\u4e8b\u53c2\u4e0e\u4f1a\u8bae"):F.Ay.error("\u8bf7\u586b\u5199\u4f1a\u8bae\u6807\u9898\u548c\u8ba8\u8bba\u8bdd\u9898")},children:[(0,E.jsxs)(d.Ay,{container:!0,spacing:B?2:4,children:[(0,E.jsxs)(d.Ay,{item:!0,xs:12,md:6,order:1,children:[(0,E.jsxs)(x.A,{sx:{p:B?2:3,mb:B?2:3},children:[(0,E.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"\u4f1a\u8bae\u4fe1\u606f"}),(0,E.jsx)(h.A,{fullWidth:!0,label:"\u4f1a\u8bae\u6807\u9898 *",value:T.title,onChange:e=>Z("title",e.target.value),sx:{mb:2},required:!0,placeholder:"\u4f8b\u5982\uff1a\u5173\u4e8e\u4eba\u5de5\u667a\u80fd\u53d1\u5c55\u7684\u8463\u4e8b\u4f1a\u8ba8\u8bba",size:"medium"}),(0,E.jsx)(h.A,{fullWidth:!0,label:"\u8ba8\u8bba\u8bdd\u9898 *",multiline:!0,rows:B?5:4,value:T.topic,onChange:e=>Z("topic",e.target.value),required:!0,placeholder:"\u8bf7\u63cf\u8ff0\u4f60\u60f3\u8ba8\u8bba\u7684\u95ee\u9898...",helperText:"\u8be6\u7ec6\u7684\u8bdd\u9898\u63cf\u8ff0\u5c06\u5e2e\u52a9\u8463\u4e8b\u4eec\u66f4\u597d\u5730\u8fdb\u884c\u8ba8\u8bba",size:"medium"})]}),(0,E.jsxs)(x.A,{sx:{p:B?2:3},children:[(0,E.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"\u4f1a\u8bae\u8bbe\u7f6e"}),(0,E.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,E.jsx)(d.Ay,{item:!0,xs:12,children:(0,E.jsxs)(u.A,{fullWidth:!0,children:[(0,E.jsx)(m.A,{children:"\u8ba8\u8bba\u6a21\u5f0f"}),(0,E.jsx)(A.A,{value:T.discussion_mode,label:"\u8ba8\u8bba\u6a21\u5f0f",onChange:e=>Z("discussion_mode",e.target.value),size:"medium",children:Object.entries(K).map(e=>{let[t,n]=e;return(0,E.jsx)(g.A,{value:t,children:n},t)})})]})}),(0,E.jsx)(d.Ay,{item:!0,xs:6,children:(0,E.jsx)(h.A,{fullWidth:!0,type:"number",label:"\u6700\u5927\u8f6e\u6570",value:T.max_rounds,onChange:e=>Z("max_rounds",parseInt(e.target.value)),inputProps:{min:1,max:20},size:"medium"})}),(0,E.jsx)(d.Ay,{item:!0,xs:6,children:(0,E.jsx)(h.A,{fullWidth:!0,type:"number",label:"\u6700\u5927\u53c2\u4e0e\u8005",value:T.max_participants,onChange:e=>Z("max_participants",parseInt(e.target.value)),inputProps:{min:1,max:10},size:"medium"})})]}),(0,E.jsxs)(j.A,{severity:"info",sx:{mt:2},children:[(0,E.jsx)("strong",{children:K[T.discussion_mode]}),":","round_robin"===T.discussion_mode&&" \u4e25\u683c\u6309\u52a0\u5165\u987a\u5e8f\u8f6e\u6d41\u53d1\u8a00\uff0c\u6bcf\u8f6e\u6bcf\u4eba\u4e00\u6b21\u673a\u4f1a\uff0c\u6709\u5e8f\u516c\u5e73","debate"===T.discussion_mode&&" \u81ea\u52a8\u5206\u6b63\u53cd\u65b9\u9635\u8425\uff0c\u652f\u6301\u53cd\u9a73\u56de\u51fb\uff0c\u89c2\u70b9\u6fc0\u70c8\u78b0\u649e","focus"===T.discussion_mode&&" \u56f4\u7ed5\u6838\u5fc3\u8bae\u9898\u9010\u5c42\u6df1\u5165\uff0c\u7ed3\u6784\u5316\u63a2\u8ba8\uff0c\u5c42\u6b21\u6e05\u6670","free"===T.discussion_mode&&" \u968f\u673a\u53d1\u8a00\u987a\u5e8f\uff0c\u652f\u6301\u4e3e\u624b\u63d2\u8bdd\uff0c\u81ea\u7136\u7075\u6d3b\u4e92\u52a8"]})]})]}),(0,E.jsx)(d.Ay,{item:!0,xs:12,md:6,order:2,children:(0,E.jsxs)(x.A,{sx:{p:B?2:3},children:[(0,E.jsxs)(a.A,{sx:{display:"flex",flexDirection:B?"column":"row",justifyContent:"space-between",alignItems:B?"stretch":"center",gap:B?2:0,mb:3},children:[(0,E.jsxs)(c.A,{variant:B?"subtitle1":"h6",children:["\u9009\u62e9\u53c2\u4e0e\u8463\u4e8b (",D.length,"/",T.max_participants,")"]}),(0,E.jsx)(l.A,{variant:"outlined",size:B?"medium":"small",onClick:()=>{M([]),R(e=>(0,s.A)((0,s.A)({},e),{},{director_ids:[]}))},disabled:0===D.length,fullWidth:B,sx:{minHeight:B?44:"auto"},children:"\u6e05\u7a7a\u9009\u62e9"})]}),Q?(0,E.jsx)(a.A,{sx:{textAlign:"center",py:4},children:(0,E.jsx)(c.A,{children:"\u52a0\u8f7d\u8463\u4e8b\u5217\u8868\u4e2d..."})}):0===N.length?(0,E.jsx)(j.A,{severity:"warning",children:"\u6682\u65e0\u6d3b\u8dc3\u8463\u4e8b\uff0c\u8bf7\u5148\u521b\u5efa\u5e76\u6fc0\u6d3b\u8463\u4e8b\u3002"}):(0,E.jsx)(d.Ay,{container:!0,spacing:B?1.5:2,children:N.map(e=>{const t=D.find(t=>t.id===e.id);return(0,E.jsx)(d.Ay,{item:!0,xs:12,children:(0,E.jsx)(p.A,{sx:{cursor:"pointer",border:t?2:1,borderColor:t?"primary.main":"divider","&:hover":{borderColor:"primary.main",boxShadow:2}},onClick:()=>V(e),children:(0,E.jsx)(f.A,{sx:{p:B?1.5:2},children:(0,E.jsxs)(a.A,{sx:{display:"flex",alignItems:"center"},children:[(0,E.jsx)(y.A,{checked:!!t,sx:{mr:B?1:2,minHeight:B?44:"auto"}}),(0,E.jsx)(b.A,{src:e.avatar_url,sx:{width:B?44:40,height:B?44:40,mr:B?1.5:2},children:(0,E.jsx)(S.A,{})}),(0,E.jsxs)(a.A,{sx:{flex:1},children:[(0,E.jsx)(c.A,{variant:B?"body1":"subtitle1",sx:{fontWeight:600},children:e.name}),(0,E.jsx)(c.A,{variant:"body2",color:"text.secondary",children:e.title}),e.expertise_areas&&(0,E.jsx)(a.A,{sx:{mt:.5},children:("string"===typeof e.expertise_areas?JSON.parse(e.expertise_areas):e.expertise_areas).slice(0,2).map((e,t)=>(0,E.jsx)(v.A,{label:e,size:"small",variant:"outlined",sx:{mr:.5,fontSize:B?"0.75rem":"0.7rem",height:B?24:20}},t))})]})]})})})},e.id)})}),D.length>0&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(_.A,{sx:{my:3}}),(0,E.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"\u5df2\u9009\u62e9\u7684\u8463\u4e8b\uff1a"}),(0,E.jsx)(a.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:D.map(e=>(0,E.jsx)(v.A,{avatar:(0,E.jsx)(b.A,{src:e.avatar_url,sx:{width:24,height:24},children:(0,E.jsx)(S.A,{sx:{fontSize:14}})}),label:e.name,onDelete:()=>V(e),color:"primary"},e.id))})]})]})})]}),(0,E.jsxs)(x.A,{sx:{p:B?2:3,mt:B?3:4,display:"flex",flexDirection:B?"column":"row",justifyContent:"space-between",alignItems:B?"stretch":"center",gap:B?2:0},children:[(0,E.jsx)(l.A,{variant:"outlined",onClick:()=>t("/hall"),size:B?"large":"medium",fullWidth:B,sx:{minHeight:B?48:"auto",order:B?2:1},children:"\u53d6\u6d88"}),(0,E.jsx)(l.A,{type:"submit",variant:"contained",startIcon:(0,E.jsx)(w.A,{}),disabled:G.isLoading,size:"large",fullWidth:B,sx:{minHeight:B?48:"auto",order:B?1:2},children:G.isLoading?"\u521b\u5efa\u4e2d...":"\u521b\u5efa\u4f1a\u8bae"})]})]})]})}}}]);