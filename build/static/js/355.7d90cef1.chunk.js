"use strict";(self.webpackChunkdongshihui_frontend=self.webpackChunkdongshihui_frontend||[]).push([[355],{355:(e,s,i)=>{i.r(s),i.d(s,{default:()=>G});var n=i(8),t=i(9950),a=i(9808),l=i(2053),r=i(2235),o=i(6491),c=i(8216),d=i(899),x=i(8089),h=i(704),u=i(5277),g=i(5333),m=i(9925),A=i(2046),j=i(5979),p=i(9647),b=i(6101),f=i(3266),y=i(4753),v=i(4745),w=i(3464),C=i(33),k=i(8170),S=i(9739),z=i(5365),E=i(4195),R=i(3563),I=i(6589),W=i(4857),H=i(1451),L=i(9223),M=i(8924),_=i(1718),D=i(2570),B=i(2375),T=i(9532),P=i(7988),Q=i(4453),F=i(8429),O=i(1920),U=i(1521),Y=i(922),Z=i(5887),q=i(4414);const G=()=>{var e,s;const i=(0,F.Zp)(),G=(0,O.useQueryClient)(),J=(0,W.A)(),K=(0,I.A)(J.breakpoints.down("md")),[N,V]=(0,t.useState)({status:"all",search:"",page:1}),[X,$]=(0,t.useState)({open:!1,meeting:null}),[ee,se]=(0,t.useState)({anchorEl:null,meeting:null}),{data:ie,isLoading:ne}=(0,O.useQuery)(["meetings",N],async()=>{const e=new URLSearchParams((0,n.A)((0,n.A)({limit:"12",offset:(12*(N.page-1)).toString()},"all"!==N.status&&{status:N.status}),N.search&&{search:N.search})),s=await fetch("https://dongshihui-api.jieshu2023.workers.dev/meetings?".concat(e),{headers:{"Cache-Control":"public, max-age=300"}}),i=await s.json();if(!i.success)throw new Error(i.error||"\u83b7\u53d6\u4f1a\u8bae\u5217\u8868\u5931\u8d25");return i},{staleTime:12e4,cacheTime:6e5,keepPreviousData:!0,onError:e=>{Z.Ay.error("\u83b7\u53d6\u4f1a\u8bae\u5217\u8868\u5931\u8d25: "+e.message)}}),te=(null===ie||void 0===ie?void 0:ie.data)||[],ae=(null===ie||void 0===ie?void 0:ie.pagination)||{},le=(0,O.useMutation)(async e=>{const s=await fetch("https://dongshihui-api.jieshu2023.workers.dev/meetings/".concat(e),{method:"DELETE"}),i=await s.json();if(!i.success)throw new Error(i.error||"\u5220\u9664\u5931\u8d25");return i},{onSuccess:()=>{Z.Ay.success("\u4f1a\u8bae\u5220\u9664\u6210\u529f"),G.invalidateQueries("meetings"),$({open:!1,meeting:null})},onError:e=>{Z.Ay.error("\u5220\u9664\u5931\u8d25: "+e.message)}}),re=(0,t.useMemo)(()=>[{value:"all",label:"\u5168\u90e8\u4f1a\u8bae"},{value:"preparing",label:"\u51c6\u5907\u4e2d"},{value:"discussing",label:"\u8ba8\u8bba\u4e2d"},{value:"paused",label:"\u5df2\u6682\u505c"},{value:"finished",label:"\u5df2\u7ed3\u675f"}],[]),oe=(0,t.useMemo)(()=>({preparing:{label:"\u51c6\u5907\u4e2d",color:"default"},discussing:{label:"\u8ba8\u8bba\u4e2d",color:"success"},debating:{label:"\u8fa9\u8bba\u4e2d",color:"warning"},paused:{label:"\u5df2\u6682\u505c",color:"info"},finished:{label:"\u5df2\u7ed3\u675f",color:"error"}}),[]),ce=(0,t.useCallback)(e=>oe[e]||{label:e,color:"default"},[oe]),de=(0,t.useCallback)((e,s)=>{V(i=>(0,n.A)((0,n.A)({},i),{},{[e]:s,page:1}))},[]),xe=(0,t.useCallback)(e=>{V(s=>(0,n.A)((0,n.A)({},s),{},{search:e,page:1}))},[]),he=(0,t.useCallback)((e,s)=>{se({anchorEl:e.currentTarget,meeting:s})},[]),ue=(0,t.useCallback)(()=>{se({anchorEl:null,meeting:null})},[]),ge=()=>(0,q.jsx)(d.Ay,{container:!0,spacing:K?2:3,children:[...Array(6)].map((e,s)=>(0,q.jsx)(d.Ay,{item:!0,xs:12,sm:6,lg:4,children:(0,q.jsx)(x.A,{sx:{height:"100%"},children:(0,q.jsxs)(h.A,{sx:{p:K?2.5:3},children:[(0,q.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,q.jsx)(o.A,{sx:{width:"60%",height:24,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}}),(0,q.jsx)(o.A,{sx:{width:60,height:24,bgcolor:"grey.200",borderRadius:12,animation:"pulse 1.5s ease-in-out infinite"}})]}),(0,q.jsx)(o.A,{sx:{width:"80%",height:16,bgcolor:"grey.200",borderRadius:1,mb:1,animation:"pulse 1.5s ease-in-out infinite"}}),(0,q.jsx)(o.A,{sx:{width:"60%",height:16,bgcolor:"grey.200",borderRadius:1,mb:2,animation:"pulse 1.5s ease-in-out infinite"}}),(0,q.jsx)(v.A,{sx:{my:2}}),(0,q.jsx)(o.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[...Array(3)].map((e,s)=>(0,q.jsx)(o.A,{sx:{width:60,height:16,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}},s))}),(0,q.jsxs)(o.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[(0,q.jsx)(o.A,{sx:{width:80,height:36,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}}),(0,q.jsx)(o.A,{sx:{width:36,height:36,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}})]})]})})},s))});return ne&&!ie?(0,q.jsxs)(a.A,{maxWidth:"lg",sx:{py:K?2:4},children:[(0,q.jsxs)(o.A,{sx:{mb:K?3:4},children:[(0,q.jsx)(o.A,{sx:{width:200,height:32,bgcolor:"grey.200",borderRadius:1,mb:1,animation:"pulse 1.5s ease-in-out infinite"}}),(0,q.jsx)(o.A,{sx:{width:300,height:20,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}})]}),(0,q.jsx)(r.A,{sx:{p:K?2:3,mb:K?2:3},children:(0,q.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,q.jsx)(d.Ay,{item:!0,xs:12,md:4,children:(0,q.jsx)(o.A,{sx:{height:56,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}})}),(0,q.jsx)(d.Ay,{item:!0,xs:12,md:3,children:(0,q.jsx)(o.A,{sx:{height:56,bgcolor:"grey.200",borderRadius:1,animation:"pulse 1.5s ease-in-out infinite"}})})]})}),(0,q.jsx)(ge,{})]}):(0,q.jsxs)(a.A,{maxWidth:"lg",sx:{py:K?2:4},children:[(0,q.jsxs)(o.A,{sx:{display:"flex",flexDirection:K?"column":"row",justifyContent:"space-between",alignItems:K?"stretch":"center",gap:K?2:0,mb:K?3:4},children:[(0,q.jsxs)(o.A,{children:[(0,q.jsx)(l.A,{variant:K?"h5":"h4",gutterBottom:!0,sx:{fontWeight:600},children:"\u4f1a\u8bae\u5386\u53f2"}),(0,q.jsx)(l.A,{variant:"body1",color:"text.secondary",children:"\u56de\u987e\u548c\u7ba1\u7406\u5386\u53f2\u8463\u4e8b\u4f1a\u4f1a\u8bae\u8bb0\u5f55"})]}),(0,q.jsx)(c.A,{variant:"contained",startIcon:(0,q.jsx)(T.A,{}),onClick:()=>i("/meetings/create"),sx:{borderRadius:2,minHeight:K?48:"auto",fontSize:K?"1rem":"0.875rem"},size:K?"large":"medium",fullWidth:K,children:"\u521b\u5efa\u65b0\u4f1a\u8bae"})]}),(0,q.jsx)(r.A,{sx:{p:K?2:3,mb:K?2:3},children:(0,q.jsxs)(d.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,q.jsx)(d.Ay,{item:!0,xs:12,md:4,children:(0,q.jsx)(m.A,{fullWidth:!0,placeholder:"\u641c\u7d22\u4f1a\u8bae\u6807\u9898\u6216\u8bdd\u9898...",value:N.search,onChange:e=>xe(e.target.value),size:"medium",InputProps:{startAdornment:(0,q.jsx)(A.A,{position:"start",children:(0,q.jsx)(L.A,{})})}})}),(0,q.jsx)(d.Ay,{item:!0,xs:12,md:3,children:(0,q.jsxs)(j.A,{fullWidth:!0,children:[(0,q.jsx)(p.A,{children:"\u4f1a\u8bae\u72b6\u6001"}),(0,q.jsx)(b.A,{value:N.status,label:"\u4f1a\u8bae\u72b6\u6001",onChange:e=>de("status",e.target.value),size:"medium",children:re.map(e=>(0,q.jsx)(f.A,{value:e.value,children:e.label},e.value))})]})}),(0,q.jsx)(d.Ay,{item:!0,xs:12,md:5,children:(0,q.jsx)(o.A,{sx:{display:"flex",alignItems:"center",gap:2,justifyContent:K?"center":"flex-start"},children:(0,q.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\u5171 ",ae.total||0," \u573a\u4f1a\u8bae"]})})})]})}),0===te.length?(0,q.jsxs)(r.A,{sx:{p:6,textAlign:"center"},children:[(0,q.jsx)(H.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,q.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:N.search||"all"!==N.status?"\u6ca1\u6709\u627e\u5230\u5339\u914d\u7684\u4f1a\u8bae":"\u8fd8\u6ca1\u6709\u4f1a\u8bae\u8bb0\u5f55"}),(0,q.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:N.search||"all"!==N.status?"\u5c1d\u8bd5\u8c03\u6574\u7b5b\u9009\u6761\u4ef6":"\u521b\u5efa\u7b2c\u4e00\u573a\u8463\u4e8b\u4f1a\u4f1a\u8bae\u5f00\u59cb\u8ba8\u8bba"}),(0,q.jsx)(c.A,{variant:"contained",onClick:()=>i("/meetings/create"),children:"\u521b\u5efa\u65b0\u4f1a\u8bae"})]}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(d.Ay,{container:!0,spacing:K?2:3,children:te.map(e=>{const s=ce(e.status);return(0,q.jsx)(d.Ay,{item:!0,xs:12,sm:6,lg:4,children:(0,q.jsx)(x.A,{sx:{height:"100%",transition:"all 0.2s ease","&:hover":{boxShadow:"0 6px 20px rgba(0,0,0,0.1)",transform:"translateY(-2px)"}},children:(0,q.jsxs)(h.A,{sx:{p:K?2.5:3},children:[(0,q.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[(0,q.jsx)(l.A,{variant:"h6",sx:{fontWeight:600,color:"#333",fontSize:K?"1rem":"1.1rem",lineHeight:1.3,flex:1,mr:1},children:e.title}),(0,q.jsx)(u.A,{label:s.label,color:s.color,size:"small",sx:{flexShrink:0}})]}),(0,q.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",lineHeight:1.5},children:e.topic}),(0,q.jsx)(v.A,{sx:{my:2}}),(0,q.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,q.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,q.jsx)(_.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,q.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[e.total_statements||0," \u53d1\u8a00"]})]}),(0,q.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,q.jsx)(D.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,q.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[e.total_participants||0," \u8463\u4e8b"]})]}),(0,q.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,q.jsx)(M.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,q.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e.created_at&&(0,U.A)(new Date(e.created_at),"MM-dd HH:mm",{locale:Y.A})})]})]}),(0,q.jsxs)(o.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end",flexDirection:K?"column":"row"},children:[(0,q.jsx)(c.A,{size:K?"medium":"small",startIcon:(0,q.jsx)(B.A,{}),onClick:()=>i("/meeting/".concat(e.id)),variant:"outlined",fullWidth:K,sx:{minHeight:K?44:"auto"},children:"finished"===e.status?"\u67e5\u770b\u8bb0\u5f55":"\u8fdb\u5165\u4f1a\u8bae"}),(0,q.jsx)(g.A,{size:K?"medium":"small",onClick:s=>he(s,e),title:"\u66f4\u591a\u64cd\u4f5c",sx:{minHeight:K?44:"auto",alignSelf:K?"flex-end":"center"},children:(0,q.jsx)(Q.A,{})})]})]})})},e.id)})}),ae.total>12&&(0,q.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,q.jsx)(y.A,{count:Math.ceil(ae.total/12),page:N.page,onChange:(e,s)=>de("page",s),color:"primary",size:"large"})})]}),(0,q.jsxs)(z.A,{anchorEl:ee.anchorEl,open:Boolean(ee.anchorEl),onClose:ue,children:[(0,q.jsxs)(f.A,{onClick:()=>{i("/meeting/".concat(ee.meeting.id)),ue()},children:[(0,q.jsx)(E.A,{children:(0,q.jsx)(B.A,{fontSize:"small"})}),(0,q.jsx)(R.A,{children:"finished"===(null===(e=ee.meeting)||void 0===e?void 0:e.status)?"\u67e5\u770b\u8bb0\u5f55":"\u8fdb\u5165\u4f1a\u8bae"})]}),(0,q.jsxs)(f.A,{onClick:()=>{$({open:!0,meeting:ee.meeting}),ue()},sx:{color:"error.main"},children:[(0,q.jsx)(E.A,{children:(0,q.jsx)(P.A,{fontSize:"small",color:"error"})}),(0,q.jsx)(R.A,{children:"\u5220\u9664\u4f1a\u8bae"})]})]}),(0,q.jsxs)(w.A,{open:X.open,onClose:()=>$({open:!1,meeting:null}),children:[(0,q.jsx)(C.A,{children:"\u786e\u8ba4\u5220\u9664\u4f1a\u8bae"}),(0,q.jsxs)(k.A,{children:[(0,q.jsxs)(l.A,{children:["\u786e\u5b9a\u8981\u5220\u9664\u4f1a\u8bae ",(0,q.jsxs)("strong",{children:['"',null===(s=X.meeting)||void 0===s?void 0:s.title,'"']})," \u5417\uff1f"]}),(0,q.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u8be5\u4f1a\u8bae\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u5305\u62ec\u53d1\u8a00\u5185\u5bb9\u3001\u7528\u6237\u63d0\u95ee\u7b49\uff0c\u4e14\u65e0\u6cd5\u6062\u590d\u3002"})]}),(0,q.jsxs)(S.A,{children:[(0,q.jsx)(c.A,{onClick:()=>$({open:!1,meeting:null}),children:"\u53d6\u6d88"}),(0,q.jsx)(c.A,{color:"error",variant:"contained",onClick:()=>le.mutate(X.meeting.id),disabled:le.isLoading,children:le.isLoading?"\u5220\u9664\u4e2d...":"\u786e\u8ba4\u5220\u9664"})]})]})]})}}}]);