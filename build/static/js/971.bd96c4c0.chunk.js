"use strict";(self.webpackChunkdongshihui_frontend=self.webpackChunkdongshihui_frontend||[]).push([[971],{9971:(e,i,s)=>{s.r(i),s.d(i,{default:()=>L});var r=s(8),t=s(9950),n=s(6589),a=s(9808),l=s(6491),d=s(8216),o=s(2053),c=s(899),x=s(2235),u=s(9925),h=s(5979),m=s(9647),p=s(6101),A=s(3266),j=s(3174),g=s(8089),f=s(704),v=s(3038),y=s(1413),b=s(5277),_=s(4745),w=s(4857),C=s(3256),z=s(4801),k=s(294),S=s(8429),W=s(1920),I=s(5887),D=s(9181),H=s(4414);const L=()=>{var e;const i=(0,S.Zp)(),s=(0,W.useQueryClient)(),L=(0,w.A)(),Q=(0,n.A)(L.breakpoints.down("md")),[B,E]=(0,t.useState)({title:"",topic:"",discussion_mode:"round_robin",max_rounds:5,max_participants:8,director_ids:[]}),[q,O]=(0,t.useState)([]),[P,F]=(0,t.useState)(null),[G,J]=(0,t.useState)(!1),{data:M,isLoading:N}=(0,W.useQuery)("activeDirectors",()=>D.hV.getActive(),{onError:e=>{I.Ay.error("\u83b7\u53d6\u8463\u4e8b\u5217\u8868\u5931\u8d25: "+e.message)}}),T=(null===M||void 0===M||null===(e=M.data)||void 0===e?void 0:e.data)||[],{data:V,isLoading:Z}=(0,W.useQuery)("directorGroups",async()=>(await fetch("https://dongshihui-api.jieshu2023.workers.dev/director-groups?user_id=default_user")).json(),{onError:e=>{console.error("\u83b7\u53d6\u8463\u4e8b\u7ec4\u5408\u5931\u8d25:",e)}}),K=(null===V||void 0===V||V.data,(0,W.useMutation)(e=>D.ej.create(e),{onSuccess:e=>{I.Ay.success("\u4f1a\u8bae\u521b\u5efa\u6210\u529f\uff01"),s.invalidateQueries("meetings"),i("/meeting/".concat(e.data.data.id))},onError:e=>{I.Ay.error("\u521b\u5efa\u4f1a\u8bae\u5931\u8d25: "+e.message)}})),R=(e,i)=>{E(s=>(0,r.A)((0,r.A)({},s),{},{[e]:i}))},U=e=>{if(q.find(i=>i.id===e.id))O(i=>i.filter(i=>i.id!==e.id)),E(i=>(0,r.A)((0,r.A)({},i),{},{director_ids:i.director_ids.filter(i=>i!==e.id)}));else{if(q.length>=B.max_participants)return void I.Ay.error("\u6700\u591a\u53ea\u80fd\u9009\u62e9".concat(B.max_participants,"\u4f4d\u8463\u4e8b"));O(i=>[...i,e]),E(i=>(0,r.A)((0,r.A)({},i),{},{director_ids:[...i.director_ids,e.id]}))}},X={round_robin:"\u8f6e\u6d41\u53d1\u8a00",debate:"\u8fa9\u8bba\u6a21\u5f0f",focus:"\u805a\u7126\u8ba8\u8bba",free:"\u81ea\u7531\u53d1\u8a00"};return(0,H.jsxs)(a.A,{maxWidth:"lg",sx:{py:Q?2:4},children:[(0,H.jsxs)(l.A,{sx:{display:"flex",flexDirection:Q?"column":"row",alignItems:Q?"stretch":"center",gap:Q?2:0,mb:Q?3:4},children:[(0,H.jsx)(d.A,{startIcon:(0,H.jsx)(z.A,{}),onClick:()=>i("/hall"),sx:{mr:Q?0:2,alignSelf:Q?"flex-start":"center",width:Q?"fit-content":"auto"},size:"medium",children:"\u8fd4\u56de"}),(0,H.jsx)(o.A,{variant:Q?"h5":"h4",component:"h1",children:"\u521b\u5efa\u65b0\u4f1a\u8bae"})]}),(0,H.jsxs)("form",{onSubmit:e=>{e.preventDefault(),B.title.trim()&&B.topic.trim()?0!==B.director_ids.length?K.mutate(B):I.Ay.error("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4f4d\u8463\u4e8b\u53c2\u4e0e\u4f1a\u8bae"):I.Ay.error("\u8bf7\u586b\u5199\u4f1a\u8bae\u6807\u9898\u548c\u8ba8\u8bba\u8bdd\u9898")},children:[(0,H.jsxs)(c.Ay,{container:!0,spacing:Q?2:4,children:[(0,H.jsxs)(c.Ay,{item:!0,xs:12,md:6,order:1,children:[(0,H.jsxs)(x.A,{sx:{p:Q?2:3,mb:Q?2:3},children:[(0,H.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"\u4f1a\u8bae\u4fe1\u606f"}),(0,H.jsx)(u.A,{fullWidth:!0,label:"\u4f1a\u8bae\u6807\u9898 *",value:B.title,onChange:e=>R("title",e.target.value),sx:{mb:2},required:!0,placeholder:"\u4f8b\u5982\uff1a\u5173\u4e8e\u4eba\u5de5\u667a\u80fd\u53d1\u5c55\u7684\u8463\u4e8b\u4f1a\u8ba8\u8bba",size:"medium"}),(0,H.jsx)(u.A,{fullWidth:!0,label:"\u8ba8\u8bba\u8bdd\u9898 *",multiline:!0,rows:Q?5:4,value:B.topic,onChange:e=>R("topic",e.target.value),required:!0,placeholder:"\u8bf7\u63cf\u8ff0\u4f60\u60f3\u8ba8\u8bba\u7684\u95ee\u9898...",helperText:"\u8be6\u7ec6\u7684\u8bdd\u9898\u63cf\u8ff0\u5c06\u5e2e\u52a9\u8463\u4e8b\u4eec\u66f4\u597d\u5730\u8fdb\u884c\u8ba8\u8bba",size:"medium"})]}),(0,H.jsxs)(x.A,{sx:{p:Q?2:3},children:[(0,H.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"\u4f1a\u8bae\u8bbe\u7f6e"}),(0,H.jsxs)(c.Ay,{container:!0,spacing:2,children:[(0,H.jsx)(c.Ay,{item:!0,xs:12,children:(0,H.jsxs)(h.A,{fullWidth:!0,children:[(0,H.jsx)(m.A,{children:"\u8ba8\u8bba\u6a21\u5f0f"}),(0,H.jsx)(p.A,{value:B.discussion_mode,label:"\u8ba8\u8bba\u6a21\u5f0f",onChange:e=>R("discussion_mode",e.target.value),size:"medium",children:Object.entries(X).map(e=>{let[i,s]=e;return(0,H.jsx)(A.A,{value:i,children:s},i)})})]})}),(0,H.jsx)(c.Ay,{item:!0,xs:6,children:(0,H.jsx)(u.A,{fullWidth:!0,type:"number",label:"\u6700\u5927\u8f6e\u6570",value:B.max_rounds,onChange:e=>R("max_rounds",parseInt(e.target.value)),inputProps:{min:1,max:20},size:"medium"})}),(0,H.jsx)(c.Ay,{item:!0,xs:6,children:(0,H.jsx)(u.A,{fullWidth:!0,type:"number",label:"\u6700\u5927\u53c2\u4e0e\u8005",value:B.max_participants,onChange:e=>R("max_participants",parseInt(e.target.value)),inputProps:{min:1,max:10},size:"medium"})})]}),(0,H.jsxs)(j.A,{severity:"info",sx:{mt:2},children:[(0,H.jsx)("strong",{children:X[B.discussion_mode]}),":","round_robin"===B.discussion_mode&&" \u4e25\u683c\u6309\u52a0\u5165\u987a\u5e8f\u8f6e\u6d41\u53d1\u8a00\uff0c\u6bcf\u8f6e\u6bcf\u4eba\u4e00\u6b21\u673a\u4f1a\uff0c\u6709\u5e8f\u516c\u5e73","debate"===B.discussion_mode&&" \u81ea\u52a8\u5206\u6b63\u53cd\u65b9\u9635\u8425\uff0c\u652f\u6301\u53cd\u9a73\u56de\u51fb\uff0c\u89c2\u70b9\u6fc0\u70c8\u78b0\u649e","focus"===B.discussion_mode&&" \u56f4\u7ed5\u6838\u5fc3\u8bae\u9898\u9010\u5c42\u6df1\u5165\uff0c\u7ed3\u6784\u5316\u63a2\u8ba8\uff0c\u5c42\u6b21\u6e05\u6670","free"===B.discussion_mode&&" \u968f\u673a\u53d1\u8a00\u987a\u5e8f\uff0c\u652f\u6301\u4e3e\u624b\u63d2\u8bdd\uff0c\u81ea\u7136\u7075\u6d3b\u4e92\u52a8"]})]})]}),(0,H.jsx)(c.Ay,{item:!0,xs:12,md:6,order:2,children:(0,H.jsxs)(x.A,{sx:{p:Q?2:3},children:[(0,H.jsxs)(l.A,{sx:{display:"flex",flexDirection:Q?"column":"row",justifyContent:"space-between",alignItems:Q?"stretch":"center",gap:Q?2:0,mb:3},children:[(0,H.jsxs)(o.A,{variant:Q?"subtitle1":"h6",children:["\u9009\u62e9\u53c2\u4e0e\u8463\u4e8b (",q.length,"/",B.max_participants,")"]}),(0,H.jsx)(d.A,{variant:"outlined",size:Q?"medium":"small",onClick:()=>{O([]),E(e=>(0,r.A)((0,r.A)({},e),{},{director_ids:[]}))},disabled:0===q.length,fullWidth:Q,sx:{minHeight:Q?44:"auto"},children:"\u6e05\u7a7a\u9009\u62e9"})]}),N?(0,H.jsx)(l.A,{sx:{textAlign:"center",py:4},children:(0,H.jsx)(o.A,{children:"\u52a0\u8f7d\u8463\u4e8b\u5217\u8868\u4e2d..."})}):0===T.length?(0,H.jsx)(j.A,{severity:"warning",children:"\u6682\u65e0\u6d3b\u8dc3\u8463\u4e8b\uff0c\u8bf7\u5148\u521b\u5efa\u5e76\u6fc0\u6d3b\u8463\u4e8b\u3002"}):(0,H.jsx)(c.Ay,{container:!0,spacing:Q?1.5:2,children:T.map(e=>{const i=q.find(i=>i.id===e.id);return(0,H.jsx)(c.Ay,{item:!0,xs:12,children:(0,H.jsx)(g.A,{sx:{cursor:"pointer",border:i?2:1,borderColor:i?"primary.main":"divider","&:hover":{borderColor:"primary.main",boxShadow:2}},onClick:()=>U(e),children:(0,H.jsx)(f.A,{sx:{p:Q?1.5:2},children:(0,H.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,H.jsx)(v.A,{checked:!!i,sx:{mr:Q?1:2,minHeight:Q?44:"auto"}}),(0,H.jsx)(y.A,{src:e.avatar_url,sx:{width:Q?44:40,height:Q?44:40,mr:Q?1.5:2},children:(0,H.jsx)(k.A,{})}),(0,H.jsxs)(l.A,{sx:{flex:1},children:[(0,H.jsx)(o.A,{variant:Q?"body1":"subtitle1",sx:{fontWeight:600},children:e.name}),(0,H.jsx)(o.A,{variant:"body2",color:"text.secondary",children:e.title}),e.expertise_areas&&(0,H.jsx)(l.A,{sx:{mt:.5},children:("string"===typeof e.expertise_areas?JSON.parse(e.expertise_areas):e.expertise_areas).slice(0,2).map((e,i)=>(0,H.jsx)(b.A,{label:e,size:"small",variant:"outlined",sx:{mr:.5,fontSize:Q?"0.75rem":"0.7rem",height:Q?24:20}},i))})]})]})})})},e.id)})}),q.length>0&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(_.A,{sx:{my:3}}),(0,H.jsx)(o.A,{variant:"subtitle1",gutterBottom:!0,children:"\u5df2\u9009\u62e9\u7684\u8463\u4e8b\uff1a"}),(0,H.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:q.map(e=>(0,H.jsx)(b.A,{avatar:(0,H.jsx)(y.A,{src:e.avatar_url,sx:{width:24,height:24},children:(0,H.jsx)(k.A,{sx:{fontSize:14}})}),label:e.name,onDelete:()=>U(e),color:"primary"},e.id))})]})]})})]}),(0,H.jsxs)(x.A,{sx:{p:Q?2:3,mt:Q?3:4,display:"flex",flexDirection:Q?"column":"row",justifyContent:"space-between",alignItems:Q?"stretch":"center",gap:Q?2:0},children:[(0,H.jsx)(d.A,{variant:"outlined",onClick:()=>i("/hall"),size:Q?"large":"medium",fullWidth:Q,sx:{minHeight:Q?48:"auto",order:Q?2:1},children:"\u53d6\u6d88"}),(0,H.jsx)(d.A,{type:"submit",variant:"contained",startIcon:(0,H.jsx)(C.A,{}),disabled:K.isLoading,size:"large",fullWidth:Q,sx:{minHeight:Q?48:"auto",order:Q?1:2},children:K.isLoading?"\u521b\u5efa\u4e2d...":"\u521b\u5efa\u4f1a\u8bae"})]})]})]})}}}]);