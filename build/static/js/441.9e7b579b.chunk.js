"use strict";(self.webpackChunkdongshihui_frontend=self.webpackChunkdongshihui_frontend||[]).push([[441],{5530:(e,t,s)=>{s.d(t,{ej:()=>i,hV:()=>n});const r=s(6910).A.create({baseURL:"https://dongshihui-api.jieshu2023.workers.dev",timeout:15e3,headers:{"Content-Type":"application/json","Cache-Control":"public, max-age=300"}});r.interceptors.request.use(e=>{var t;return console.log("\ud83d\udd04 API\u8bf7\u6c42: ".concat(null===(t=e.method)||void 0===t?void 0:t.toUpperCase()," ").concat(e.url)),e},e=>(console.error("\u274c API\u8bf7\u6c42\u9519\u8bef:",e),Promise.reject(e))),r.interceptors.response.use(e=>(console.log("\u2705 API\u54cd\u5e94: ".concat(e.config.url),e.data),e),e=>{var t,s,r;if(console.error("\u274c API\u54cd\u5e94\u9519\u8bef:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),404===(null===(s=e.response)||void 0===s?void 0:s.status))throw new Error("API\u7aef\u70b9\u4e0d\u5b58\u5728");if(500===(null===(r=e.response)||void 0===r?void 0:r.status))throw new Error("\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef");if("ECONNREFUSED"===e.code)throw new Error("\u65e0\u6cd5\u8fde\u63a5\u5230\u670d\u52a1\u5668\uff0c\u8bf7\u786e\u4fdd\u540e\u7aef\u670d\u52a1\u6b63\u5728\u8fd0\u884c");throw e});const n={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.get("/directors",{params:e})},getById:e=>r.get("/directors/".concat(e)),create:e=>r.post("/directors",e),update:(e,t)=>r.put("/directors/".concat(e),t),delete:e=>r.delete("/directors/".concat(e)),getActive:()=>r.get("/directors/active/list"),parsePrompt:e=>r.post("/directors/parse-prompt",{system_prompt:e}),createFromPrompt:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r.post("/directors/create-from-prompt",{system_prompt:e,avatar_url:t})},getStats:e=>r.get("/directors/".concat(e,"/stats")),batchUpdateStatus:(e,t,s)=>r.patch("/directors/batch-status",{director_ids:e,status:t,is_active:s}),reparseDirector:e=>r.post("/directors/".concat(e,"/reparse"))},i={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.get("/meetings",{params:e})},create:e=>r.post("/meetings",e),getById:e=>r.get("/meetings/".concat(e)),start:e=>r.post("/meetings/".concat(e,"/start")),pause:e=>r.post("/meetings/".concat(e,"/pause")),finish:e=>r.post("/meetings/".concat(e,"/finish")),resume:e=>r.post("/meetings/".concat(e,"/resume")),generateNextStatement:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.post("/meetings/".concat(e,"/next-statement"),t)},getStatements:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.get("/meetings/".concat(e,"/statements"),{params:t})},getStats:e=>r.get("/meetings/".concat(e,"/stats")),addParticipants:(e,t)=>r.post("/meetings/".concat(e,"/participants"),t)}},7441:(e,t,s)=>{s.r(t),s.d(t,{default:()=>q});var r=s(9950),n=s(6589),i=s(5277),a=s(9808),l=s(6491),o=s(2053),c=s(8216),d=s(2235),x=s(9925),h=s(2046),u=s(1408),A=s(1320),p=s(5769),g=s(9780),m=s(9213),j=s(1671),y=s(3038),v=s(4075),f=s(1413),b=s(5333),w=s(1434),C=s(899),P=s(8089),k=s(704),_=s(5365),S=s(3266),I=s(3464),z=s(33),E=s(8170),D=s(9739),W=s(4857),H=s(3256),L=s(379),R=s(6281),M=s(294),T=s(9715),U=s(5810),N=s(1920),O=s(8429),B=s(1521),Q=s(922),V=s(5887),F=s(5530),J=s(4414);const q=()=>{var e,t;const s=(0,O.Zp)(),q=(0,N.useQueryClient)(),G=(0,W.A)(),Y=(0,n.A)(G.breakpoints.down("md")),[Z,K]=(0,r.useState)(0),[X,$]=(0,r.useState)(10),[ee,te]=(0,r.useState)(""),[se,re]=(0,r.useState)([]),[ne,ie]=(0,r.useState)({open:!1,director:null}),[ae,le]=(0,r.useState)({anchorEl:null,director:null}),{data:oe,isLoading:ce}=(0,N.useQuery)(["directors",Z,X,ee],()=>F.hV.getAll(),{onError:e=>{V.Ay.error("\u83b7\u53d6\u8463\u4e8b\u5217\u8868\u5931\u8d25: "+e.message)}}),de=((null===oe||void 0===oe||null===(e=oe.data)||void 0===e?void 0:e.data)||[]).filter(e=>!ee||e.name.toLowerCase().includes(ee.toLowerCase())||e.title.toLowerCase().includes(ee.toLowerCase())),xe=de.slice(Z*X,(Z+1)*X),he=de.length,ue=(0,N.useMutation)(e=>F.hV.delete(e),{onSuccess:()=>{V.Ay.success("\u8463\u4e8b\u5220\u9664\u6210\u529f"),q.invalidateQueries("directors"),ie({open:!1,director:null})},onError:e=>{V.Ay.error("\u5220\u9664\u5931\u8d25: "+e.message)}}),Ae=(0,N.useMutation)(e=>{let{ids:t,status:s,isActive:r}=e;return F.hV.batchUpdateStatus(t,s,r)},{onSuccess:e=>{V.Ay.success("\u6210\u529f\u66f4\u65b0 ".concat(e.data.updated_count," \u4e2a\u8463\u4e8b")),q.invalidateQueries("directors"),re([])},onError:e=>{V.Ay.error("\u6279\u91cf\u66f4\u65b0\u5931\u8d25: "+e.message)}}),pe=e=>{re(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},ge=e=>{if(!e.is_active)return(0,J.jsx)(i.A,{label:"\u5df2\u7981\u7528",color:"error",size:"small"});switch(e.status){case"active":return(0,J.jsx)(i.A,{label:"\u6d3b\u8dc3",color:"success",size:"small"});case"inactive":return(0,J.jsx)(i.A,{label:"\u975e\u6d3b\u8dc3",color:"warning",size:"small"});case"retired":return(0,J.jsx)(i.A,{label:"\u5df2\u9000\u4f11",color:"default",size:"small"});default:return(0,J.jsx)(i.A,{label:e.status,color:"default",size:"small"})}};return(0,J.jsxs)(a.A,{maxWidth:"lg",sx:{py:Y?2:4},children:[(0,J.jsxs)(l.A,{sx:{display:"flex",flexDirection:Y?"column":"row",justifyContent:"space-between",alignItems:Y?"stretch":"center",gap:Y?2:0,mb:Y?3:4},children:[(0,J.jsx)(o.A,{variant:Y?"h5":"h4",component:"h1",children:"\u8463\u4e8b\u7ba1\u7406"}),(0,J.jsxs)(l.A,{sx:{display:"flex",gap:Y?1:2,flexDirection:Y?"column":"row"},children:[(0,J.jsx)(c.A,{variant:"outlined",startIcon:(0,J.jsx)(U.A,{}),onClick:()=>(0,V.Ay)("\u6279\u91cf\u5bfc\u5165\u529f\u80fd\u5f00\u53d1\u4e2d..."),size:Y?"large":"medium",fullWidth:Y,sx:{minHeight:Y?48:"auto"},children:"\u6279\u91cf\u5bfc\u5165"}),(0,J.jsx)(c.A,{variant:"contained",startIcon:(0,J.jsx)(H.A,{}),onClick:()=>s("/directors/create"),size:Y?"large":"medium",fullWidth:Y,sx:{minHeight:Y?48:"auto"},children:"\u521b\u5efa\u8463\u4e8b"})]})]}),(0,J.jsxs)(d.A,{sx:{p:Y?2:3,mb:Y?2:3},children:[(0,J.jsx)(l.A,{sx:{display:"flex",gap:2,alignItems:"center",mb:2,flexDirection:Y?"column":"row"},children:(0,J.jsx)(x.A,{placeholder:"\u641c\u7d22\u8463\u4e8b\u59d3\u540d\u6216\u8eab\u4efd...",value:ee,onChange:e=>{te(e.target.value),K(0)},InputProps:{startAdornment:(0,J.jsx)(h.A,{position:"start",children:(0,J.jsx)(T.A,{})})},sx:{flexGrow:1},fullWidth:Y,size:"medium"})}),se.length>0&&(0,J.jsxs)(l.A,{sx:{display:"flex",gap:Y?1:2,alignItems:"center",flexDirection:Y?"column":"row",alignItems:Y?"stretch":"center"},children:[(0,J.jsxs)(o.A,{variant:"body2",sx:{textAlign:Y?"center":"left"},children:["\u5df2\u9009\u62e9 ",se.length," \u4e2a\u8463\u4e8b"]}),(0,J.jsxs)(l.A,{sx:{display:"flex",gap:1,flexDirection:Y?"column":"row",width:Y?"100%":"auto"},children:[(0,J.jsx)(c.A,{size:Y?"medium":"small",onClick:()=>Ae.mutate({ids:se,is_active:!1}),fullWidth:Y,sx:{minHeight:Y?44:"auto"},children:"\u6279\u91cf\u7981\u7528"}),(0,J.jsx)(c.A,{size:Y?"medium":"small",onClick:()=>Ae.mutate({ids:se,is_active:!0,status:"active"}),fullWidth:Y,sx:{minHeight:Y?44:"auto"},children:"\u6279\u91cf\u542f\u7528"}),(0,J.jsx)(c.A,{size:Y?"medium":"small",color:"error",onClick:()=>{V.Ay.error("\u6279\u91cf\u5220\u9664\u529f\u80fd\u9700\u8981\u4e8c\u6b21\u786e\u8ba4")},fullWidth:Y,sx:{minHeight:Y?44:"auto"},children:"\u6279\u91cf\u5220\u9664"})]})]})]}),(0,J.jsx)(u.A,{mdDown:!0,children:(0,J.jsxs)(A.A,{component:d.A,children:[(0,J.jsxs)(p.A,{children:[(0,J.jsx)(g.A,{children:(0,J.jsxs)(m.A,{children:[(0,J.jsx)(j.A,{padding:"checkbox",children:(0,J.jsx)(y.A,{indeterminate:se.length>0&&se.length<xe.length,checked:xe.length>0&&se.length===xe.length,onChange:e=>{e.target.checked?re(xe.map(e=>e.id)):re([])}})}),(0,J.jsx)(j.A,{children:"\u8463\u4e8b"}),(0,J.jsx)(j.A,{children:"\u8eab\u4efd"}),(0,J.jsx)(j.A,{children:"\u65f6\u4ee3"}),(0,J.jsx)(j.A,{children:"\u72b6\u6001"}),(0,J.jsx)(j.A,{align:"center",children:"\u7edf\u8ba1"}),(0,J.jsx)(j.A,{children:"\u521b\u5efa\u65f6\u95f4"}),(0,J.jsx)(j.A,{align:"center",children:"\u64cd\u4f5c"})]})}),(0,J.jsx)(v.A,{children:ce?[...Array(5)].map((e,t)=>(0,J.jsx)(m.A,{children:(0,J.jsx)(j.A,{colSpan:8,sx:{textAlign:"center",py:4},children:"\u52a0\u8f7d\u4e2d..."})},t)):0===xe.length?(0,J.jsx)(m.A,{children:(0,J.jsxs)(j.A,{colSpan:8,sx:{textAlign:"center",py:8},children:[(0,J.jsx)(M.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,J.jsx)(o.A,{variant:"body1",color:"text.secondary",children:ee?"\u6ca1\u6709\u627e\u5230\u5339\u914d\u7684\u8463\u4e8b":'\u8fd8\u6ca1\u6709\u8463\u4e8b\uff0c\u70b9\u51fb"\u521b\u5efa\u8463\u4e8b"\u5f00\u59cb\u6dfb\u52a0'})]})}):xe.map(e=>(0,J.jsxs)(m.A,{selected:se.includes(e.id),children:[(0,J.jsx)(j.A,{padding:"checkbox",children:(0,J.jsx)(y.A,{checked:se.includes(e.id),onChange:()=>pe(e.id)})}),(0,J.jsx)(j.A,{children:(0,J.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,J.jsx)(f.A,{src:e.avatar_url,sx:{width:40,height:40},children:(0,J.jsx)(M.A,{})}),(0,J.jsxs)(l.A,{children:[(0,J.jsx)(o.A,{variant:"subtitle2",children:e.name}),e.expertise_areas&&(0,J.jsx)(o.A,{variant:"caption",color:"text.secondary",children:("string"===typeof e.expertise_areas?JSON.parse(e.expertise_areas):e.expertise_areas).slice(0,2).join(", ")})]})]})}),(0,J.jsx)(j.A,{children:(0,J.jsx)(o.A,{variant:"body2",children:e.title})}),(0,J.jsx)(j.A,{children:(0,J.jsx)(o.A,{variant:"body2",color:"text.secondary",children:e.era||"-"})}),(0,J.jsx)(j.A,{children:ge(e)}),(0,J.jsx)(j.A,{align:"center",children:(0,J.jsxs)(l.A,{children:[(0,J.jsxs)(o.A,{variant:"body2",children:[e.total_statements," \u53d1\u8a00"]}),(0,J.jsxs)(o.A,{variant:"caption",color:"text.secondary",children:[e.total_meetings," \u4f1a\u8bae"]})]})}),(0,J.jsx)(j.A,{children:(0,J.jsx)(o.A,{variant:"body2",color:"text.secondary",children:(0,B.A)(new Date(e.created_at),"yyyy-MM-dd HH:mm",{locale:Q.A})})}),(0,J.jsxs)(j.A,{align:"center",children:[(0,J.jsx)(b.A,{onClick:()=>s("/directors/edit/".concat(e.id)),title:"\u7f16\u8f91\u8463\u4e8b",children:(0,J.jsx)(L.A,{})}),(0,J.jsx)(b.A,{onClick:t=>le({anchorEl:t.currentTarget,director:e}),title:"\u66f4\u591a\u64cd\u4f5c",children:(0,J.jsx)(R.A,{})})]})]},e.id))})]}),(0,J.jsx)(w.A,{component:"div",count:he,page:Z,onPageChange:(e,t)=>K(t),rowsPerPage:X,onRowsPerPageChange:e=>{$(parseInt(e.target.value,10)),K(0)},rowsPerPageOptions:[5,10,25,50],labelRowsPerPage:"\u6bcf\u9875\u663e\u793a:",labelDisplayedRows:e=>{let{from:t,to:s,count:r}=e;return"".concat(t,"-").concat(s," \u5171 ").concat(r," \u6761")}})]})}),(0,J.jsx)(u.A,{mdUp:!0,children:ce?(0,J.jsx)(d.A,{sx:{p:4,textAlign:"center"},children:(0,J.jsx)(o.A,{variant:"h6",children:"\u52a0\u8f7d\u8463\u4e8b\u5217\u8868\u4e2d..."})}):0===xe.length?(0,J.jsxs)(d.A,{sx:{p:6,textAlign:"center"},children:[(0,J.jsx)(M.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,J.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:ee?"\u6ca1\u6709\u627e\u5230\u5339\u914d\u7684\u8463\u4e8b":"\u8fd8\u6ca1\u6709\u8463\u4e8b"}),(0,J.jsx)(o.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:ee?"\u5c1d\u8bd5\u8c03\u6574\u641c\u7d22\u6761\u4ef6":"\u521b\u5efa\u7b2c\u4e00\u4e2a\u8463\u4e8b\u5f00\u59cb\u7ba1\u7406"}),(0,J.jsx)(c.A,{variant:"contained",onClick:()=>s("/directors/create"),children:"\u521b\u5efa\u8463\u4e8b"})]}):(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(C.Ay,{container:!0,spacing:2,children:xe.map(e=>(0,J.jsx)(C.Ay,{item:!0,xs:12,children:(0,J.jsx)(P.A,{sx:{transition:"all 0.2s ease","&:hover":{boxShadow:"0 6px 20px rgba(0,0,0,0.1)",transform:"translateY(-2px)"}},children:(0,J.jsxs)(k.A,{sx:{p:2.5},children:[(0,J.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,J.jsx)(y.A,{checked:se.includes(e.id),onChange:()=>pe(e.id),sx:{mr:1}}),(0,J.jsx)(f.A,{src:e.avatar_url,sx:{width:48,height:48,mr:2},children:(0,J.jsx)(M.A,{})}),(0,J.jsxs)(l.A,{sx:{flex:1},children:[(0,J.jsx)(o.A,{variant:"h6",sx:{fontWeight:600,fontSize:"1.1rem"},children:e.name}),(0,J.jsx)(o.A,{variant:"body2",color:"text.secondary",children:e.title})]}),(0,J.jsxs)(l.A,{sx:{display:"flex",gap:1},children:[(0,J.jsx)(b.A,{onClick:()=>s("/directors/edit/".concat(e.id)),title:"\u7f16\u8f91\u8463\u4e8b",size:"large",sx:{minHeight:44,minWidth:44},children:(0,J.jsx)(L.A,{})}),(0,J.jsx)(b.A,{onClick:t=>le({anchorEl:t.currentTarget,director:e}),title:"\u66f4\u591a\u64cd\u4f5c",size:"large",sx:{minHeight:44,minWidth:44},children:(0,J.jsx)(R.A,{})})]})]}),(0,J.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,J.jsx)(l.A,{children:ge(e)}),(0,J.jsx)(o.A,{variant:"body2",color:"text.secondary",children:e.era||"\u672a\u8bbe\u7f6e\u65f6\u4ee3"})]}),(0,J.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,J.jsx)(o.A,{variant:"body2",fontWeight:"bold",children:"\u53c2\u4e0e\u7edf\u8ba1\uff1a"}),(0,J.jsxs)(o.A,{variant:"body2",children:[e.total_statements," \u53d1\u8a00 \u2022 ",e.total_meetings," \u4f1a\u8bae"]})]}),e.expertise_areas&&(0,J.jsxs)(l.A,{sx:{mb:1},children:[(0,J.jsx)(o.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"\u4e13\u4e1a\u9886\u57df\uff1a"}),(0,J.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:("string"===typeof e.expertise_areas?JSON.parse(e.expertise_areas):e.expertise_areas).map((e,t)=>(0,J.jsx)(i.A,{label:e,size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}},t))})]}),(0,J.jsxs)(o.A,{variant:"caption",color:"text.secondary",children:["\u521b\u5efa\u4e8e ",(0,B.A)(new Date(e.created_at),"yyyy-MM-dd HH:mm",{locale:Q.A})]})]})})},e.id))}),(0,J.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:3},children:(0,J.jsx)(w.A,{component:"div",count:he,page:Z,onPageChange:(e,t)=>K(t),rowsPerPage:X,onRowsPerPageChange:e=>{$(parseInt(e.target.value,10)),K(0)},rowsPerPageOptions:[5,10,25],labelRowsPerPage:"\u6bcf\u9875:",labelDisplayedRows:e=>{let{from:t,to:s,count:r}=e;return"".concat(t,"-").concat(s," / ").concat(r)},sx:{"& .MuiTablePagination-toolbar":{paddingLeft:1,paddingRight:1},"& .MuiTablePagination-selectLabel, & .MuiTablePagination-displayedRows":{fontSize:"0.875rem"}}})})]})}),(0,J.jsxs)(_.A,{anchorEl:ae.anchorEl,open:Boolean(ae.anchorEl),onClose:()=>le({anchorEl:null,director:null}),children:[(0,J.jsx)(S.A,{onClick:()=>{s("/directors/details/".concat(ae.director.id)),le({anchorEl:null,director:null})},children:"\u67e5\u770b\u7edf\u8ba1"}),(0,J.jsx)(S.A,{onClick:()=>{s("/directors/details/".concat(ae.director.id)),le({anchorEl:null,director:null})},children:"\u67e5\u770b\u8be6\u60c5"}),(0,J.jsx)(S.A,{onClick:()=>{ie({open:!0,director:ae.director}),le({anchorEl:null,director:null})},sx:{color:"error.main"},children:"\u5220\u9664\u8463\u4e8b"})]}),(0,J.jsxs)(I.A,{open:ne.open,onClose:()=>ie({open:!1,director:null}),children:[(0,J.jsx)(z.A,{children:"\u786e\u8ba4\u5220\u9664"}),(0,J.jsx)(E.A,{children:(0,J.jsxs)(o.A,{children:['\u786e\u5b9a\u8981\u5220\u9664\u8463\u4e8b "',null===(t=ne.director)||void 0===t?void 0:t.name,'" \u5417\uff1f \u6b64\u64cd\u4f5c\u4e0d\u53ef\u64a4\u9500\u3002']})}),(0,J.jsxs)(D.A,{children:[(0,J.jsx)(c.A,{onClick:()=>ie({open:!1,director:null}),children:"\u53d6\u6d88"}),(0,J.jsx)(c.A,{color:"error",onClick:()=>ue.mutate(ne.director.id),disabled:ue.isLoading,children:ue.isLoading?"\u5220\u9664\u4e2d...":"\u786e\u8ba4\u5220\u9664"})]})]})]})}}}]);