"use strict";(self.webpackChunkdongshihui_frontend=self.webpackChunkdongshihui_frontend||[]).push([[971],{5530:(e,t,r)=>{r.d(t,{ej:()=>n,hV:()=>i});const s=r(6910).A.create({baseURL:"https://dongshihui-api.jieshu2023.workers.dev",timeout:15e3,headers:{"Content-Type":"application/json","Cache-Control":"public, max-age=300"}});s.interceptors.request.use(e=>{var t;return console.log("\ud83d\udd04 API\u8bf7\u6c42: ".concat(null===(t=e.method)||void 0===t?void 0:t.toUpperCase()," ").concat(e.url)),e},e=>(console.error("\u274c API\u8bf7\u6c42\u9519\u8bef:",e),Promise.reject(e))),s.interceptors.response.use(e=>(console.log("\u2705 API\u54cd\u5e94: ".concat(e.config.url),e.data),e),e=>{var t,r,s;if(console.error("\u274c API\u54cd\u5e94\u9519\u8bef:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),404===(null===(r=e.response)||void 0===r?void 0:r.status))throw new Error("API\u7aef\u70b9\u4e0d\u5b58\u5728");if(500===(null===(s=e.response)||void 0===s?void 0:s.status))throw new Error("\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef");if("ECONNREFUSED"===e.code)throw new Error("\u65e0\u6cd5\u8fde\u63a5\u5230\u670d\u52a1\u5668\uff0c\u8bf7\u786e\u4fdd\u540e\u7aef\u670d\u52a1\u6b63\u5728\u8fd0\u884c");throw e});const i={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s.get("/directors",{params:e})},getById:e=>s.get("/directors/".concat(e)),create:e=>s.post("/directors",e),update:(e,t)=>s.put("/directors/".concat(e),t),delete:e=>s.delete("/directors/".concat(e)),getActive:()=>s.get("/directors/active/list"),parsePrompt:e=>s.post("/directors/parse-prompt",{system_prompt:e}),createFromPrompt:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return s.post("/directors/create-from-prompt",{system_prompt:e,avatar_url:t})},getStats:e=>s.get("/directors/".concat(e,"/stats")),batchUpdateStatus:(e,t,r)=>s.patch("/directors/batch-status",{director_ids:e,status:t,is_active:r}),reparseDirector:e=>s.post("/directors/".concat(e,"/reparse"))},n={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s.get("/meetings",{params:e})},create:e=>s.post("/meetings",e),getById:e=>s.get("/meetings/".concat(e)),start:e=>s.post("/meetings/".concat(e,"/start")),pause:e=>s.post("/meetings/".concat(e,"/pause")),finish:e=>s.post("/meetings/".concat(e,"/finish")),resume:e=>s.post("/meetings/".concat(e,"/resume")),generateNextStatement:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.post("/meetings/".concat(e,"/next-statement"),t)},getStatements:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.get("/meetings/".concat(e,"/statements"),{params:t})},getStats:e=>s.get("/meetings/".concat(e,"/stats")),addParticipants:(e,t)=>s.post("/meetings/".concat(e,"/participants"),t)}},9971:(e,t,r)=>{r.r(t),r.d(t,{default:()=>D});var s=r(8),i=r(9950),n=r(6589),a=r(9808),o=r(6491),d=r(8216),l=r(2053),c=r(899),u=r(2235),m=r(9925),h=r(5979),p=r(9647),x=r(6101),g=r(3266),A=r(3174),j=r(8089),v=r(704),f=r(3038),y=r(1413),_=r(5277),b=r(4745),w=r(4857),C=r(3256),S=r(4801),I=r(294),k=r(8429),z=r(1920),P=r(5887),W=r(5530),E=r(4414);const D=()=>{var e;const t=(0,k.Zp)(),r=(0,z.useQueryClient)(),D=(0,w.A)(),B=(0,n.A)(D.breakpoints.down("md")),[L,H]=(0,i.useState)({title:"",topic:"",discussion_mode:"round_robin",max_rounds:5,max_participants:8,director_ids:[]}),[N,Q]=(0,i.useState)([]),[U,q]=(0,i.useState)(null),[F,O]=(0,i.useState)(!1),{data:R,isLoading:T}=(0,z.useQuery)("activeDirectors",()=>W.hV.getActive(),{onError:e=>{P.Ay.error("\u83b7\u53d6\u8463\u4e8b\u5217\u8868\u5931\u8d25: "+e.message)}}),V=(null===R||void 0===R||null===(e=R.data)||void 0===e?void 0:e.data)||[],{data:G,isLoading:J}=(0,z.useQuery)("directorGroups",async()=>(await fetch("https://dongshihui-api.jieshu2023.workers.dev/director-groups?user_id=default_user")).json(),{onError:e=>{console.error("\u83b7\u53d6\u8463\u4e8b\u7ec4\u5408\u5931\u8d25:",e)}}),M=(null===G||void 0===G||G.data,(0,z.useMutation)(e=>W.ej.create(e),{onSuccess:e=>{P.Ay.success("\u4f1a\u8bae\u521b\u5efa\u6210\u529f\uff01"),r.invalidateQueries("meetings"),t("/meeting/".concat(e.data.data.id))},onError:e=>{P.Ay.error("\u521b\u5efa\u4f1a\u8bae\u5931\u8d25: "+e.message)}})),Z=(e,t)=>{H(r=>(0,s.A)((0,s.A)({},r),{},{[e]:t}))},K=e=>{if(N.find(t=>t.id===e.id))Q(t=>t.filter(t=>t.id!==e.id)),H(t=>(0,s.A)((0,s.A)({},t),{},{director_ids:t.director_ids.filter(t=>t!==e.id)}));else{if(N.length>=L.max_participants)return void P.Ay.error("\u6700\u591a\u53ea\u80fd\u9009\u62e9".concat(L.max_participants,"\u4f4d\u8463\u4e8b"));Q(t=>[...t,e]),H(t=>(0,s.A)((0,s.A)({},t),{},{director_ids:[...t.director_ids,e.id]}))}},X={round_robin:"\u8f6e\u6d41\u53d1\u8a00",debate:"\u8fa9\u8bba\u6a21\u5f0f",focus:"\u805a\u7126\u8ba8\u8bba",free:"\u81ea\u7531\u53d1\u8a00"};return(0,E.jsxs)(a.A,{maxWidth:"lg",sx:{py:B?2:4},children:[(0,E.jsxs)(o.A,{sx:{display:"flex",flexDirection:B?"column":"row",alignItems:B?"stretch":"center",gap:B?2:0,mb:B?3:4},children:[(0,E.jsx)(d.A,{startIcon:(0,E.jsx)(S.A,{}),onClick:()=>t("/hall"),sx:{mr:B?0:2,alignSelf:B?"flex-start":"center",width:B?"fit-content":"auto"},size:"medium",children:"\u8fd4\u56de"}),(0,E.jsx)(l.A,{variant:B?"h5":"h4",component:"h1",children:"\u521b\u5efa\u65b0\u4f1a\u8bae"})]}),(0,E.jsxs)("form",{onSubmit:e=>{e.preventDefault(),L.title.trim()&&L.topic.trim()?0!==L.director_ids.length?M.mutate(L):P.Ay.error("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4f4d\u8463\u4e8b\u53c2\u4e0e\u4f1a\u8bae"):P.Ay.error("\u8bf7\u586b\u5199\u4f1a\u8bae\u6807\u9898\u548c\u8ba8\u8bba\u8bdd\u9898")},children:[(0,E.jsxs)(c.Ay,{container:!0,spacing:B?2:4,children:[(0,E.jsxs)(c.Ay,{item:!0,xs:12,md:6,order:1,children:[(0,E.jsxs)(u.A,{sx:{p:B?2:3,mb:B?2:3},children:[(0,E.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u4f1a\u8bae\u4fe1\u606f"}),(0,E.jsx)(m.A,{fullWidth:!0,label:"\u4f1a\u8bae\u6807\u9898 *",value:L.title,onChange:e=>Z("title",e.target.value),sx:{mb:2},required:!0,placeholder:"\u4f8b\u5982\uff1a\u5173\u4e8e\u4eba\u5de5\u667a\u80fd\u53d1\u5c55\u7684\u8463\u4e8b\u4f1a\u8ba8\u8bba",size:"medium"}),(0,E.jsx)(m.A,{fullWidth:!0,label:"\u8ba8\u8bba\u8bdd\u9898 *",multiline:!0,rows:B?5:4,value:L.topic,onChange:e=>Z("topic",e.target.value),required:!0,placeholder:"\u8bf7\u63cf\u8ff0\u4f60\u60f3\u8ba8\u8bba\u7684\u95ee\u9898...",helperText:"\u8be6\u7ec6\u7684\u8bdd\u9898\u63cf\u8ff0\u5c06\u5e2e\u52a9\u8463\u4e8b\u4eec\u66f4\u597d\u5730\u8fdb\u884c\u8ba8\u8bba",size:"medium"})]}),(0,E.jsxs)(u.A,{sx:{p:B?2:3},children:[(0,E.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u4f1a\u8bae\u8bbe\u7f6e"}),(0,E.jsxs)(c.Ay,{container:!0,spacing:2,children:[(0,E.jsx)(c.Ay,{item:!0,xs:12,children:(0,E.jsxs)(h.A,{fullWidth:!0,children:[(0,E.jsx)(p.A,{children:"\u8ba8\u8bba\u6a21\u5f0f"}),(0,E.jsx)(x.A,{value:L.discussion_mode,label:"\u8ba8\u8bba\u6a21\u5f0f",onChange:e=>Z("discussion_mode",e.target.value),size:"medium",children:Object.entries(X).map(e=>{let[t,r]=e;return(0,E.jsx)(g.A,{value:t,children:r},t)})})]})}),(0,E.jsx)(c.Ay,{item:!0,xs:6,children:(0,E.jsx)(m.A,{fullWidth:!0,type:"number",label:"\u6700\u5927\u8f6e\u6570",value:L.max_rounds,onChange:e=>Z("max_rounds",parseInt(e.target.value)),inputProps:{min:1,max:20},size:"medium"})}),(0,E.jsx)(c.Ay,{item:!0,xs:6,children:(0,E.jsx)(m.A,{fullWidth:!0,type:"number",label:"\u6700\u5927\u53c2\u4e0e\u8005",value:L.max_participants,onChange:e=>Z("max_participants",parseInt(e.target.value)),inputProps:{min:1,max:10},size:"medium"})})]}),(0,E.jsxs)(A.A,{severity:"info",sx:{mt:2},children:[(0,E.jsx)("strong",{children:X[L.discussion_mode]}),":","round_robin"===L.discussion_mode&&" \u4e25\u683c\u6309\u52a0\u5165\u987a\u5e8f\u8f6e\u6d41\u53d1\u8a00\uff0c\u6bcf\u8f6e\u6bcf\u4eba\u4e00\u6b21\u673a\u4f1a\uff0c\u6709\u5e8f\u516c\u5e73","debate"===L.discussion_mode&&" \u81ea\u52a8\u5206\u6b63\u53cd\u65b9\u9635\u8425\uff0c\u652f\u6301\u53cd\u9a73\u56de\u51fb\uff0c\u89c2\u70b9\u6fc0\u70c8\u78b0\u649e","focus"===L.discussion_mode&&" \u56f4\u7ed5\u6838\u5fc3\u8bae\u9898\u9010\u5c42\u6df1\u5165\uff0c\u7ed3\u6784\u5316\u63a2\u8ba8\uff0c\u5c42\u6b21\u6e05\u6670","free"===L.discussion_mode&&" \u968f\u673a\u53d1\u8a00\u987a\u5e8f\uff0c\u652f\u6301\u4e3e\u624b\u63d2\u8bdd\uff0c\u81ea\u7136\u7075\u6d3b\u4e92\u52a8"]})]})]}),(0,E.jsx)(c.Ay,{item:!0,xs:12,md:6,order:2,children:(0,E.jsxs)(u.A,{sx:{p:B?2:3},children:[(0,E.jsxs)(o.A,{sx:{display:"flex",flexDirection:B?"column":"row",justifyContent:"space-between",alignItems:B?"stretch":"center",gap:B?2:0,mb:3},children:[(0,E.jsxs)(l.A,{variant:B?"subtitle1":"h6",children:["\u9009\u62e9\u53c2\u4e0e\u8463\u4e8b (",N.length,"/",L.max_participants,")"]}),(0,E.jsx)(d.A,{variant:"outlined",size:B?"medium":"small",onClick:()=>{Q([]),H(e=>(0,s.A)((0,s.A)({},e),{},{director_ids:[]}))},disabled:0===N.length,fullWidth:B,sx:{minHeight:B?44:"auto"},children:"\u6e05\u7a7a\u9009\u62e9"})]}),T?(0,E.jsx)(o.A,{sx:{textAlign:"center",py:4},children:(0,E.jsx)(l.A,{children:"\u52a0\u8f7d\u8463\u4e8b\u5217\u8868\u4e2d..."})}):0===V.length?(0,E.jsx)(A.A,{severity:"warning",children:"\u6682\u65e0\u6d3b\u8dc3\u8463\u4e8b\uff0c\u8bf7\u5148\u521b\u5efa\u5e76\u6fc0\u6d3b\u8463\u4e8b\u3002"}):(0,E.jsx)(c.Ay,{container:!0,spacing:B?1.5:2,children:V.map(e=>{const t=N.find(t=>t.id===e.id);return(0,E.jsx)(c.Ay,{item:!0,xs:12,children:(0,E.jsx)(j.A,{sx:{cursor:"pointer",border:t?2:1,borderColor:t?"primary.main":"divider","&:hover":{borderColor:"primary.main",boxShadow:2}},onClick:()=>K(e),children:(0,E.jsx)(v.A,{sx:{p:B?1.5:2},children:(0,E.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,E.jsx)(f.A,{checked:!!t,sx:{mr:B?1:2,minHeight:B?44:"auto"}}),(0,E.jsx)(y.A,{src:e.avatar_url,sx:{width:B?44:40,height:B?44:40,mr:B?1.5:2},children:(0,E.jsx)(I.A,{})}),(0,E.jsxs)(o.A,{sx:{flex:1},children:[(0,E.jsx)(l.A,{variant:B?"body1":"subtitle1",sx:{fontWeight:600},children:e.name}),(0,E.jsx)(l.A,{variant:"body2",color:"text.secondary",children:e.title}),e.expertise_areas&&(0,E.jsx)(o.A,{sx:{mt:.5},children:("string"===typeof e.expertise_areas?JSON.parse(e.expertise_areas):e.expertise_areas).slice(0,2).map((e,t)=>(0,E.jsx)(_.A,{label:e,size:"small",variant:"outlined",sx:{mr:.5,fontSize:B?"0.75rem":"0.7rem",height:B?24:20}},t))})]})]})})})},e.id)})}),N.length>0&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(b.A,{sx:{my:3}}),(0,E.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"\u5df2\u9009\u62e9\u7684\u8463\u4e8b\uff1a"}),(0,E.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:N.map(e=>(0,E.jsx)(_.A,{avatar:(0,E.jsx)(y.A,{src:e.avatar_url,sx:{width:24,height:24},children:(0,E.jsx)(I.A,{sx:{fontSize:14}})}),label:e.name,onDelete:()=>K(e),color:"primary"},e.id))})]})]})})]}),(0,E.jsxs)(u.A,{sx:{p:B?2:3,mt:B?3:4,display:"flex",flexDirection:B?"column":"row",justifyContent:"space-between",alignItems:B?"stretch":"center",gap:B?2:0},children:[(0,E.jsx)(d.A,{variant:"outlined",onClick:()=>t("/hall"),size:B?"large":"medium",fullWidth:B,sx:{minHeight:B?48:"auto",order:B?2:1},children:"\u53d6\u6d88"}),(0,E.jsx)(d.A,{type:"submit",variant:"contained",startIcon:(0,E.jsx)(C.A,{}),disabled:M.isLoading,size:"large",fullWidth:B,sx:{minHeight:B?48:"auto",order:B?1:2},children:M.isLoading?"\u521b\u5efa\u4e2d...":"\u521b\u5efa\u4f1a\u8bae"})]})]})]})}}}]);