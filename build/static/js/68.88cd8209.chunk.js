"use strict";(self.webpackChunkdongshihui_frontend=self.webpackChunkdongshihui_frontend||[]).push([[68],{9068:(e,s,t)=>{t.r(s),t.d(s,{default:()=>B});var r=t(9950),i=t(9808),n=t(2053),a=t(6491),o=t(8216),c=t(3174),l=t(899),d=t(8089),h=t(704),u=t(5333),x=t(5277),A=t(3464),j=t(33),m=t(8170),p=t(9925),y=t(249),g=t(4446),f=t(3038),v=t(8614),b=t(1413),w=t(3563),C=t(9739),k=t(3256),_=t(760),S=t(7920),W=t(6724),I=t(8429),z=t(1521),T=t(922),E=t(5887),O=t(4414);const B=()=>{const e=(0,I.Zp)(),[s,t]=(0,r.useState)([]),[B,D]=(0,r.useState)([]),[J,M]=(0,r.useState)(!0),[N,P]=(0,r.useState)(!1),[H,L]=(0,r.useState)(!1),[R,Z]=(0,r.useState)(null),[q,F]=(0,r.useState)(""),[G,K]=(0,r.useState)(""),[Q,U]=(0,r.useState)([]),[V,X]=(0,r.useState)(""),[Y,$]=(0,r.useState)("");(0,r.useEffect)(()=>{ee(),se()},[]);const ee=async()=>{try{const e=await fetch("https://dongshihui-api.jieshu2023.workers.dev/director-groups?user_id=default_user"),s=await e.json();s.success&&t(s.data)}catch(e){console.error("\u83b7\u53d6\u8463\u4e8b\u7ec4\u5408\u5931\u8d25:",e),E.Ay.error("\u83b7\u53d6\u8463\u4e8b\u7ec4\u5408\u5931\u8d25")}finally{M(!1)}},se=async()=>{try{const e=await fetch("https://dongshihui-api.jieshu2023.workers.dev/directors"),s=await e.json();s.success&&D(s.data)}catch(e){console.error("\u83b7\u53d6\u8463\u4e8b\u5217\u8868\u5931\u8d25:",e)}},te=()=>{F(""),K(""),U([])};return J?(0,O.jsx)(i.A,{maxWidth:"lg",sx:{py:4},children:(0,O.jsx)(n.A,{variant:"h6",children:"\u52a0\u8f7d\u4e2d..."})}):(0,O.jsxs)(i.A,{maxWidth:"lg",sx:{py:3},children:[(0,O.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,O.jsx)(n.A,{variant:"h4",component:"h1",children:"\u6211\u7684\u8463\u4e8b\u7ec4\u5408"}),(0,O.jsx)(o.A,{variant:"contained",startIcon:(0,O.jsx)(k.A,{}),onClick:()=>P(!0),children:"\u521b\u5efa\u65b0\u7ec4\u5408"})]}),0===s.length?(0,O.jsx)(c.A,{severity:"info",sx:{textAlign:"center"},children:"\u8fd8\u6ca1\u6709\u521b\u5efa\u4efb\u4f55\u8463\u4e8b\u7ec4\u5408\uff0c\u521b\u5efa\u4e00\u4e2a\u4e13\u5c5e\u7684\u8463\u4e8b\u4f1a\u5427\uff01"}):(0,O.jsx)(l.Ay,{container:!0,spacing:3,children:s.map(s=>(0,O.jsx)(l.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,O.jsx)(d.A,{sx:{height:"100%"},children:(0,O.jsxs)(h.A,{children:[(0,O.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[(0,O.jsx)(n.A,{variant:"h6",component:"h3",children:s.name}),(0,O.jsx)(u.A,{size:"small",color:"error",onClick:()=>(async e=>{if(window.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u8463\u4e8b\u7ec4\u5408\u5417\uff1f"))try{const s=await fetch("https://dongshihui-api.jieshu2023.workers.dev/director-groups/".concat(e,"?user_id=default_user"),{method:"DELETE"}),t=await s.json();t.success?(E.Ay.success("\u8463\u4e8b\u7ec4\u5408\u5220\u9664\u6210\u529f"),ee()):E.Ay.error(t.error||"\u5220\u9664\u5931\u8d25")}catch(s){console.error("\u5220\u9664\u7ec4\u5408\u5931\u8d25:",s),E.Ay.error("\u5220\u9664\u7ec4\u5408\u5931\u8d25")}})(s.id),children:(0,O.jsx)(_.A,{})})]}),s.description&&(0,O.jsx)(n.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:s.description}),(0,O.jsxs)(a.A,{sx:{display:"flex",gap:1,mb:2},children:[(0,O.jsx)(x.A,{label:"".concat(s.member_count," \u4f4d\u8463\u4e8b"),size:"small",color:"primary",variant:"outlined"}),(0,O.jsx)(x.A,{label:"\u4f7f\u7528 ".concat(s.usage_count," \u6b21"),size:"small",variant:"outlined"})]}),(0,O.jsxs)(n.A,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:2},children:["\u521b\u5efa\u4e8e ",(0,z.A)(new Date(s.created_at),"yyyy\u5e74MM\u6708dd\u65e5",{locale:T.A})]}),(0,O.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,O.jsx)(o.A,{variant:"contained",size:"small",startIcon:(0,O.jsx)(W.A,{}),onClick:()=>{Z(s),L(!0)},sx:{flex:1},children:"\u521b\u5efa\u4f1a\u8bae"}),(0,O.jsx)(o.A,{variant:"outlined",size:"small",startIcon:(0,O.jsx)(S.A,{}),onClick:()=>e("/director-groups/".concat(s.id)),children:"\u67e5\u770b\u8be6\u60c5"})]})]})})},s.id))}),(0,O.jsxs)(A.A,{open:N,onClose:()=>P(!1),maxWidth:"md",fullWidth:!0,children:[(0,O.jsx)(j.A,{children:"\u521b\u5efa\u8463\u4e8b\u7ec4\u5408"}),(0,O.jsxs)(m.A,{children:[(0,O.jsx)(p.A,{fullWidth:!0,label:"\u7ec4\u5408\u540d\u79f0",value:q,onChange:e=>F(e.target.value),sx:{mb:2,mt:1}}),(0,O.jsx)(p.A,{fullWidth:!0,multiline:!0,rows:2,label:"\u7ec4\u5408\u63cf\u8ff0\uff08\u53ef\u9009\uff09",value:G,onChange:e=>K(e.target.value),sx:{mb:3}}),(0,O.jsx)(n.A,{variant:"subtitle1",gutterBottom:!0,children:"\u9009\u62e9\u8463\u4e8b\u6210\u5458\uff1a"}),(0,O.jsx)(y.A,{sx:{maxHeight:300,overflow:"auto"},children:B.map(e=>{var s;return(0,O.jsxs)(g.Ay,{dense:!0,button:!0,onClick:()=>{return s=e.id,void U(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},children:[(0,O.jsx)(f.A,{checked:Q.includes(e.id),tabIndex:-1,disableRipple:!0}),(0,O.jsx)(v.A,{children:(0,O.jsx)(b.A,{src:e.avatar_url,children:null===(s=e.name)||void 0===s?void 0:s[0]})}),(0,O.jsx)(w.A,{primary:e.name,secondary:"".concat(e.title," \xb7 ").concat(e.era)})]},e.id)})}),(0,O.jsxs)(n.A,{variant:"caption",color:"text.secondary",children:["\u5df2\u9009\u62e9 ",Q.length," \u4f4d\u8463\u4e8b"]})]}),(0,O.jsxs)(C.A,{children:[(0,O.jsx)(o.A,{onClick:()=>{P(!1),te()},children:"\u53d6\u6d88"}),(0,O.jsx)(o.A,{onClick:async()=>{if(q.trim()&&0!==Q.length)try{const e=await fetch("https://dongshihui-api.jieshu2023.workers.dev/director-groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:q.trim(),description:G.trim(),director_ids:Q,user_id:"default_user"})}),s=await e.json();s.success?(E.Ay.success("\u8463\u4e8b\u7ec4\u5408\u521b\u5efa\u6210\u529f\uff01"),P(!1),te(),ee()):E.Ay.error(s.error||"\u521b\u5efa\u5931\u8d25")}catch(e){console.error("\u521b\u5efa\u7ec4\u5408\u5931\u8d25:",e),E.Ay.error("\u521b\u5efa\u7ec4\u5408\u5931\u8d25")}else E.Ay.error("\u8bf7\u586b\u5199\u7ec4\u5408\u540d\u79f0\u5e76\u9009\u62e9\u81f3\u5c11\u4e00\u4f4d\u8463\u4e8b")},variant:"contained",disabled:!q.trim()||0===Q.length,children:"\u521b\u5efa\u7ec4\u5408"})]})]}),(0,O.jsxs)(A.A,{open:H,onClose:()=>L(!1),maxWidth:"sm",fullWidth:!0,children:[(0,O.jsxs)(j.A,{children:['\u57fa\u4e8e "',null===R||void 0===R?void 0:R.name,'" \u521b\u5efa\u4f1a\u8bae']}),(0,O.jsxs)(m.A,{children:[(0,O.jsx)(p.A,{fullWidth:!0,label:"\u4f1a\u8bae\u6807\u9898",value:V,onChange:e=>X(e.target.value),sx:{mb:2,mt:1}}),(0,O.jsx)(p.A,{fullWidth:!0,multiline:!0,rows:3,label:"\u8ba8\u8bba\u8bdd\u9898",value:Y,onChange:e=>$(e.target.value),placeholder:"\u8bf7\u8f93\u5165\u8981\u8ba8\u8bba\u7684\u8bdd\u9898..."}),R&&(0,O.jsx)(a.A,{sx:{mt:2},children:(0,O.jsxs)(n.A,{variant:"subtitle2",gutterBottom:!0,children:["\u5c06\u9080\u8bf7 ",R.member_count," \u4f4d\u8463\u4e8b\u53c2\u4e0e\u8ba8\u8bba"]})})]}),(0,O.jsxs)(C.A,{children:[(0,O.jsx)(o.A,{onClick:()=>{L(!1),X(""),$("")},children:"\u53d6\u6d88"}),(0,O.jsx)(o.A,{onClick:async()=>{if(V.trim()&&Y.trim())try{const s=await fetch("https://dongshihui-api.jieshu2023.workers.dev/meetings/from-group/".concat(R.id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:V.trim(),topic:Y.trim(),discussion_mode:"round_robin",max_rounds:10})}),t=await s.json();t.success?(E.Ay.success("\u4f1a\u8bae\u521b\u5efa\u6210\u529f\uff01"),L(!1),X(""),$(""),e("/meeting/".concat(t.data.id))):E.Ay.error(t.error||"\u521b\u5efa\u4f1a\u8bae\u5931\u8d25")}catch(s){console.error("\u521b\u5efa\u4f1a\u8bae\u5931\u8d25:",s),E.Ay.error("\u521b\u5efa\u4f1a\u8bae\u5931\u8d25")}else E.Ay.error("\u8bf7\u586b\u5199\u4f1a\u8bae\u6807\u9898\u548c\u8bdd\u9898")},variant:"contained",disabled:!V.trim()||!Y.trim(),children:"\u521b\u5efa\u4f1a\u8bae"})]})]})]})}}}]);